ä¸‹é¢ç»™ä½ ä¸€ä»½ **JavaScript `typeof` è¿ç®—ç¬¦çš„ä½¿ç”¨å¤§å…¨**ï¼ŒåŒ…æ‹¬è¯­æ³•ã€æ‰€æœ‰è¿”å›å€¼ã€ä½¿ç”¨åœºæ™¯ã€æ³¨æ„äº‹é¡¹ã€å¸¸è§å‘ç‚¹ä¸æœ€ä½³å®è·µã€‚

---

# ğŸ“Œ ä¸€ã€`typeof` åŸºæœ¬è¯­æ³•

```js
typeof operand
```

æˆ–æ›´å¸¸è§å½¢å¼ï¼š

```js
typeof(operand)
```

ä¸¤è€…å®Œå…¨ç­‰ä»·ã€‚

---

# ğŸ“Œ äºŒã€`typeof` çš„æ‰€æœ‰å¯èƒ½è¿”å›å€¼ï¼ˆå…± 8 ç§ï¼‰

| è¿”å›å€¼           | è¯´æ˜            | ç¤ºä¾‹                         |
| ------------- | ------------- | -------------------------- |
| `"number"`    | æ•°å­—ï¼ˆåŒ…æ‹¬ NaNï¼‰    | `typeof 1`                 |
| `"string"`    | å­—ç¬¦ä¸²           | `typeof "abc"`             |
| `"boolean"`   | å¸ƒå°”å€¼           | `typeof true`              |
| `"undefined"` | æœªå®šä¹‰           | `typeof undefined`         |
| `"object"`    | å¯¹è±¡ç±»å‹ï¼ˆå« nullï¼ï¼‰ | `typeof {}`, `typeof null` |
| `"function"`  | å‡½æ•°            | `typeof function(){}`      |
| `"symbol"`    | ES6 Symbol    | `typeof Symbol()`          |
| `"bigint"`    | å¤§æ•´æ•°ç±»å‹         | `typeof 123n`              |

---

# ğŸ“Œ ä¸‰ã€ä¸åŒç±»å‹ä¸‹ `typeof` çš„ç»“æœï¼ˆå¤§å…¨ï¼‰

## âœ”ï¸ 1. åŸºæœ¬ç±»å‹

```js
typeof 123         // "number"
typeof NaN         // "number"
typeof Infinity    // "number"
typeof 'Hello'     // "string"
typeof true        // "boolean"
typeof undefined   // "undefined"
typeof Symbol()    // "symbol"
typeof 123n        // "bigint"
```

---

## âœ”ï¸ 2. ç‰¹æ®Šå¯¹è±¡

```js
typeof null        // "object"   (å†å²é—ç•™ bug)
typeof []          // "object"
typeof {}          // "object"
typeof new Date()  // "object"
typeof /abc/       // "object"
typeof new Map()   // "object"
typeof new Set()   // "object"
```

---

## âœ”ï¸ 3. å‡½æ•°åŠå¯è°ƒç”¨å¯¹è±¡

```js
typeof function(){}       // "function"
typeof class A{}          // "function"
typeof () => {}           // "function"
typeof Math.sin           // "function"
```

> æ³¨æ„ï¼š**class æœ¬è´¨ä¸Šä¹Ÿæ˜¯å‡½æ•°**ã€‚

---

## âœ”ï¸ 4. æœªå£°æ˜å˜é‡

```js
typeof foo    // "undefined" ï¼ˆä¸ä¼šæŠ¥é”™ï¼‰
```

è¿™ç‚¹éå¸¸é‡è¦ï¼Œå¯ä»¥å®‰å…¨åœ°åˆ¤æ–­å˜é‡æ˜¯å¦å­˜åœ¨ã€‚

---

# ğŸ“Œ å››ã€`typeof` çš„ä¼˜ç‚¹

| ç‰¹æ€§         | æè¿°                                           |
| ---------- | -------------------------------------------- |
| å®‰å…¨åˆ¤æ–­æœªå£°æ˜å˜é‡  | `typeof x === "undefined"` ä¸æŠ¥ ReferenceError |
| ç®€å•ã€è½»é‡      | åŸºç¡€ç±»å‹åˆ¤æ–­å¾ˆæ–¹ä¾¿                                    |
| å¯åˆ¤æ–­å‡½æ•°ç±»å‹    | `typeof fn === 'function'`                   |
| æ”¯æŒ ES6+ ç±»å‹ | bigint, symbol                               |

---

# ğŸ“Œ äº”ã€`typeof` çš„ç¼ºé™·ä¸å‘ç‚¹ï¼ˆåŠ¡å¿…æ³¨æ„ï¼‰

## âŒ 1. æ— æ³•åŒºåˆ†å¯¹è±¡ç±»å‹

```js
typeof []   // "object"
typeof {}   // "object"
typeof null // "object"
```

> ä¸èƒ½ç”¨æ¥åˆ¤æ–­æ•°ç»„ã€æ—¥æœŸã€æ­£åˆ™ç­‰ã€‚

---

## âŒ 2. å¯¹ null è¿”å› `"object"`ï¼ˆJS å†å² bugï¼‰

è¿™æ˜¯ JS æœ€è‡­åæ˜­è‘—çš„â€œè¯­è¨€å…«å¤§å‘â€ä¹‹ä¸€ã€‚

---

## âŒ 3. `typeof NaN` è¿”å› `"number"`

```js
typeof NaN  // "number"
```

åˆ¤æ–­ NaN åº”ä½¿ç”¨ `Number.isNaN()`ã€‚

---

## âŒ 4. æ‰€æœ‰ class éƒ½è¿”å› `"function"`

```js
class A{}
typeof A   // "function"
```

---

# ğŸ“Œ å…­ã€`typeof` ä½¿ç”¨åœºæ™¯ï¼ˆæœ€ä½³å®è·µï¼‰

## â­ 1. åˆ¤æ–­åŸºç¡€ç±»å‹

```js
if (typeof name === "string") { ... }
```

## â­ 2. åˆ¤æ–­å‡½æ•°ï¼ˆæœ€å¸¸ç”¨ï¼‰

```js
if (typeof callback === "function") { ... }
```

## â­ 3. åˆ¤æ–­å˜é‡æ˜¯å¦å£°æ˜è¿‡ï¼ˆä¸ä¼šæŠ¥é”™ï¼‰

```js
if (typeof window.foo === "undefined") {
    // safe
}
```

## â­ 4. æ¨¡å—åˆ¤æ–­ï¼ˆå¦‚ Node/æµè§ˆå™¨ï¼‰

```js
if (typeof window !== "undefined") {
    // è¿è¡Œåœ¨æµè§ˆå™¨
}
```

## â­ 5. åˆ¤æ–­ BigInt / Symbol

```js
if (typeof id === "bigint") { ... }
```

---

# ğŸ“Œ ä¸ƒã€ç»“åˆç¤ºä¾‹çš„ `typeof` é€ŸæŸ¥è¡¨ï¼ˆæœ€å…¨ï¼‰

```js
typeof 1                 // "number"
typeof NaN               // "number"
typeof 'abc'             // "string"
typeof true              // "boolean"
typeof undefined         // "undefined"
typeof Symbol()          // "symbol"
typeof 123n              // "bigint"

typeof {}                // "object"
typeof []                // "object"
typeof null              // "object"
typeof new Date()        // "object"
typeof /re/g             // "object"
typeof new Map()         // "object"

typeof function(){}      // "function"
typeof class A{}         // "function"
typeof () => {}          // "function"

typeof x                 // "undefined"ï¼ˆx æœªå£°æ˜ï¼‰
```

---

# ğŸ“Œ å…«ã€è¡¥å……ï¼šåˆ¤æ–­æ‰€æœ‰ç±»å‹çš„æ›´å¼ºæ–¹å¼ï¼ˆç›¸æ¯” typeof æ›´å¯é ï¼‰

å¦‚æœä½ éœ€è¦åˆ¤æ–­â€œç²¾ç¡®ç±»å‹â€ï¼Œæ¨èç”¨ï¼š

```js
Object.prototype.toString.call(value)
```

ä¹Ÿå¯ä»¥å°è£…æˆï¼š

```js
const type = v => Object.prototype.toString.call(v).slice(8, -1);
```



## ä¸€ã€`instanceof` æ˜¯ä»€ä¹ˆï¼Ÿ

**ä½œç”¨ï¼š**
åˆ¤æ–­æŸä¸ªå¯¹è±¡çš„åŸå‹é“¾ä¸Šï¼Œæ˜¯å¦å‡ºç°è¿‡æ„é€ å‡½æ•°çš„ `prototype`ã€‚

**è¯­æ³•ï¼š**

```js
A instanceof B
```

å«ä¹‰ï¼š

> åˆ¤æ–­ **A çš„åŸå‹é“¾ä¸Š** æ˜¯å¦èƒ½æ‰¾åˆ° **B.prototype**ï¼Œè¿”å› `true` / `false`ã€‚

---

## äºŒã€æœ€å¸¸ç”¨çš„åŸºæœ¬ç¤ºä¾‹

```js
[] instanceof Array          // true
[] instanceof Object         // true  ï¼ˆArray ç»§æ‰¿è‡ª Objectï¼‰
({}) instanceof Object       // true

function Person(){}
const p = new Person()
p instanceof Person          // true
p instanceof Object          // true

new Date() instanceof Date   // true
/abc/ instanceof RegExp      // true
```

è®°ä½ä¸€æ¡ï¼š

> `instanceof` åªèƒ½åˆ¤æ–­ **å¼•ç”¨ç±»å‹ï¼ˆå¯¹è±¡ï¼‰**ï¼Œä¸èƒ½å‡†ç¡®åˆ¤æ–­åŸå§‹ç±»å‹ã€‚

---

## ä¸‰ã€ä¸èƒ½æ­£ç¡®åˆ¤æ–­çš„æƒ…å†µï¼ˆåŸå§‹ç±»å‹ï¼‰

```js
123 instanceof Number        // false
'abc' instanceof String      // false
true instanceof Boolean      // false
```

åŸå› ï¼š
`123`ã€`'abc'`ã€`true` æ˜¯ **åŸå§‹å€¼**ï¼Œä¸æ˜¯ `new Number()` è¿™ç§ **åŒ…è£…å¯¹è±¡**ã€‚

å¯¹æ¯”ï¼š

```js
new Number(123) instanceof Number   // true
new String('abc') instanceof String // true
new Boolean(true) instanceof Boolean// true
```

> âš ï¸ ä¸€èˆ¬é¡¹ç›®ä¸­ **ä¸æ¨è** ä½¿ç”¨ `new Number`ã€`new String` ç­‰åŒ…è£…å¯¹è±¡ï¼Œå®¹æ˜“å¸¦æ¥æ··æ·†ã€‚

---

## å››ã€`instanceof` çš„å·¥ä½œåŸç†ï¼ˆé‡ç‚¹ï¼‰

**ç®€åŒ–ç†è§£ï¼š**

```js
A instanceof B
```

ç­‰ä»·äºï¼š

> ä» `A.__proto__` å¼€å§‹ï¼Œä¸€ç›´é¡ºç€åŸå‹é“¾å¾€ä¸Šæ‰¾ï¼š
> åªè¦æœ‰ä¸€ä¸ª === `B.prototype` å°±è¿”å› `true`ï¼Œå¦åˆ™è¿”å› `false`ã€‚

ä¼ªä»£ç ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š

```js
function myInstanceof(obj, Constructor) {
  let proto = Object.getPrototypeOf(obj)
  const prototype = Constructor.prototype

  while (proto) {
    if (proto === prototype) return true
    proto = Object.getPrototypeOf(proto)
  }

  return false
}
```

---

## äº”ã€é…åˆç»§æ‰¿ä½¿ç”¨ï¼ˆéå¸¸å¸¸è§ï¼‰

```js
class Animal {}
class Dog extends Animal {}

const dog = new Dog()

dog instanceof Dog      // true
dog instanceof Animal   // true
dog instanceof Object   // true
```

**è§£é‡Šï¼š**

`dog.__proto__ === Dog.prototype`
`Dog.prototype.__proto__ === Animal.prototype`
`Animal.prototype.__proto__ === Object.prototype`

æ‰€ä»¥ä¸‰ä¸ªéƒ½ä¸º `true`ã€‚

---

## å…­ã€å¸¸è§å†…ç½®å¯¹è±¡çš„ `instanceof`

```js
[] instanceof Array           // true
[] instanceof Object          // true

new Date() instanceof Date    // true
new Date() instanceof Object  // true

/abc/ instanceof RegExp       // true
/abc/ instanceof Object       // true

new Map() instanceof Map      // true
new Set() instanceof Set      // true
```

---

## ä¸ƒã€è·¨ iframe / window çš„å‘ï¼ˆé‡è¦ï¼‰

`instanceof` çš„åˆ¤æ–­æ˜¯åŸºäº **åŒä¸€å¥—åŸå‹é“¾** çš„ã€‚

å¦‚æœä¸€ä¸ªå¯¹è±¡æ¥è‡ª **å¦ä¸€ä¸ª iframe** æˆ– **å¦ä¸€ä¸ª window**ï¼š

```js
// å‡è®¾ arr æ˜¯ä»å¦ä¸€ä¸ª iframe ä¼ è¿‡æ¥çš„æ•°ç»„
arr instanceof Array   // å¯èƒ½æ˜¯ false
```

å› ä¸ºä¸¤ä¸ªç¯å¢ƒçš„ `Array.prototype` ä¸æ˜¯åŒä¸€ä¸ªå¼•ç”¨ã€‚

è¿™ç§æƒ…å†µä¸‹åˆ¤æ–­æ•°ç»„ï¼Œæ›´æ¨èï¼š

```js
Object.prototype.toString.call(arr) === '[object Array]'
Array.isArray(arr) // âœ… è·¨çª—å£ä¹Ÿå®‰å…¨
```

---

## å…«ã€`instanceof` ä¸å‡½æ•° / class

### 1. æ™®é€šæ„é€ å‡½æ•°

```js
function Person() {}
const p = new Person()

p instanceof Person  // true
p instanceof Object  // true
```

### 2. class

```js
class A {}
const a = new A()

a instanceof A       // true
a instanceof Object  // true
```

### 3. **å‡½æ•°æœ¬èº«** ä¹Ÿæ˜¯å¯¹è±¡

```js
function fn(){}
fn instanceof Function  // true
fn instanceof Object    // true

class C {}
C instanceof Function   // true
C instanceof Object     // true
```

---

## ä¹ã€`Symbol.hasInstance` è‡ªå®šä¹‰ `instanceof` è¡Œä¸ºï¼ˆè¿›é˜¶ï¼‰

ES6 å…è®¸ä½ é‡å†™ `instanceof` çš„é€»è¾‘ï¼š

```js
class Even {
  static [Symbol.hasInstance](x) {
    return typeof x === 'number' && x % 2 === 0
  }
}

2 instanceof Even     // true
3 instanceof Even     // false
10 instanceof Even    // true
```

è¿™é‡Œ `Even` ä¸å†æ˜¯æ„é€ å‡½æ•°äº†ï¼Œè€Œæ˜¯ä¸€ä¸ª **â€œè§„åˆ™â€**ã€‚

---

## åã€`instanceof` å¸¸è§ä½¿ç”¨åœºæ™¯

### âœ… 1. åˆ¤æ–­æ˜¯å¦æ˜¯æŸä¸ªç±»çš„å®ä¾‹

```js
if (err instanceof Error) {
  console.error('é”™è¯¯ä¿¡æ¯ï¼š', err.message)
}
```

### âœ… 2. åˆ¤æ–­è‡ªå®šä¹‰ç±»

```js
class Person {}
function isPerson(obj) {
  return obj instanceof Person
}
```

### âœ… 3. åˆ¤æ–­æ˜¯å¦æ˜¯æŸç§å†…ç½®å¯¹è±¡

```js
function format(val) {
  if (val instanceof Date) {
    return val.toISOString()
  }
  return String(val)
}
```

---

## åä¸€ã€`instanceof` VS `typeof` VS `Object.prototype.toString`ï¼ˆå¯¹æ¯”ï¼‰

| æ–¹å¼                                 | é€‚ç”¨åœºæ™¯        | ä¼˜ç‚¹              | ç¼ºç‚¹                           |
| ---------------------------------- | ----------- | --------------- | ---------------------------- |
| `typeof`                           | åŸºæœ¬ç±»å‹ã€å‡½æ•°     | ç®€å•ã€å¿«é€Ÿ           | æ— æ³•åŒºåˆ†å¯¹è±¡ç±»å‹ï¼Œ`null` æ˜¯ `"object"` |
| `instanceof`                       | å¯¹è±¡ã€ç±»å®ä¾‹ã€ç»§æ‰¿å…³ç³» | èƒ½çœ‹å‡ºâ€œæ˜¯å¦ç”±æŸæ„é€ å‡½æ•°åˆ›å»ºâ€ | ä¸èƒ½åˆ¤æ–­åŸå§‹ç±»å‹ï¼Œè·¨ iframe ä¸å¯é         |
| `Object.prototype.toString.call()` | ç²¾ç¡®åˆ¤æ–­æ‰€æœ‰ç±»å‹    | æœ€é€šç”¨ã€æœ€ç¨³å®š         | å†™æ³•ç•¥é•¿ï¼Œéœ€è¦å°è£…                    |

**ç®€å•è®°å¿†ï¼š**

* åˆ¤æ–­ **â€œæ˜¯ä¸æ˜¯å¯¹è±¡/ç±»çš„å®ä¾‹â€** ğŸ‘‰ ç”¨ `instanceof`
* åˆ¤æ–­ **åŸºç¡€ç±»å‹** ğŸ‘‰ ç”¨ `typeof`
* è¦ **ç²¾ç¡®åˆ¤æ–­æ‰€æœ‰ç±»å‹** ğŸ‘‰ ç”¨ `Object.prototype.toString.call`

---

## åäºŒã€å®é™…å¼€å‘ä¸­çš„æ¨èç”¨æ³•æ€»ç»“

1. **åˆ¤æ–­ç±»å®ä¾‹ï¼š**

   ```js
   if (obj instanceof MyClass) { ... }
   ```

2. **å¤„ç†é”™è¯¯ï¼š**

   ```js
   if (e instanceof Error) { ... }
   ```

3. **é…åˆç»§æ‰¿é“¾åšç±»å‹åˆ†å‘ï¼š**

   ```js
   if (shape instanceof Circle) { ... }
   else if (shape instanceof Rectangle) { ... }
   ```

4. **é¿å…ç”¨ `instanceof` åˆ¤æ–­æ•°ç»„**
   æ¨èï¼š

   ```js
   Array.isArray(value)
   ```

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥æ¥ç€å¸®ä½ å†™ä¸€ä»½ï¼š

* âœ… `typeof + instanceof + Object.toString` çš„ **ç»¼åˆç±»å‹åˆ¤æ–­å·¥å…·åº“**
* âœ… ç»™å‡ºä¸€ä¸ª `isArray / isPlainObject / isPromise / isFunction ...` çš„å®Œæ•´å®ç°æ–‡ä»¶ï¼ˆå¯ç›´æ¥ç”¨åœ¨é¡¹ç›®é‡Œï¼‰

