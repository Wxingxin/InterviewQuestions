JavaScript 的 **空值合并运算符（Nullish Coalescing Operator）** `??` 是 ES2020（ES11）引入的逻辑运算符，用于在**左侧值为 `null` 或 `undefined` 时**返回右侧的默认值。它与逻辑或运算符 `||` 类似，但**仅对 `null` 和 `undefined` 生效**，而不会误判其他假值（如 `0`、`false`、空字符串等）。以下是关于该运算符的全面总结：

### 一、基本语法

```javascript
leftExpr ?? rightExpr;
```

- **返回值**：  
  如果 `leftExpr` 是 `null` 或 `undefined`，则返回 `rightExpr`；否则返回 `leftExpr`。

### 二、核心特性

#### 1. **仅处理 `null` 和 `undefined`**

```javascript
console.log(null ?? "default"); // "default"
console.log(undefined ?? "default"); // "default"
console.log(0 ?? 100); // 0（0 是有效数值，不触发默认值）
console.log(false ?? true); // false（布尔值不触发默认值）
console.log("" ?? "empty"); // ""（空字符串不触发默认值）
```

#### 2. **与逻辑或运算符 `||` 的对比**

`||` 会将所有假值（如 `0`、`false`、空字符串）视为无效值，而 `??` 仅针对 `null` 和 `undefined`：

```javascript
// 使用 ||（误判假值）
console.log(0 || 100); // 100（错误：0 被视为无效值）
console.log(false || true); // true（错误：false 被视为无效值）

// 使用 ??（仅对 null/undefined 生效）
console.log(0 ?? 100); // 0（正确：0 是有效数值）
console.log(false ?? true); // false（正确：false 是有效布尔值）
```

#### 3. **链式使用**

```javascript
const a = null;
const b = undefined;
const c = 0;

console.log(a ?? b ?? c ?? 100); // 0（最终使用有效数值 0）
```

#### 4. **与可选链操作符 `?.` 结合**

```javascript
const user = {
  settings: {
    darkMode: false,
  },
};

// 安全获取嵌套属性并提供默认值
const mode = user?.settings?.darkMode ?? true;
console.log(mode); // false（使用实际值，而非默认值）
```

### 三、常见应用场景

#### 1. **默认配置**

```javascript
function initApp(options) {
  const theme = options.theme ?? "light"; // 仅当 theme 为 null/undefined 时使用默认值
  const maxSize = options.maxSize ?? 1024;

  console.log(`Theme: ${theme}, Max Size: ${maxSize}`);
}

initApp({ theme: null, maxSize: 0 }); // "Theme: light, Max Size: 0"
```

#### 2. **DOM 元素属性**

```javascript
const element = document.querySelector("#my-element");
const width = element?.style.width ?? "100px"; // 元素或属性不存在时使用默认值
```

#### 3. **数值计算**

```javascript
function calculateTotal(values) {
  const sum = values.reduce((acc, val) => acc + (val ?? 0), 0); // 处理可能的 null/undefined 值
  return sum;
}

console.log(calculateTotal([1, null, 3])); // 4（null 被视为 0）
```

### 四、注意事项

1. **不可与 `||` 或 `&&` 直接混用**

   ```javascript
   // 报错：禁止直接混用，需用括号明确优先级
   const result = null || undefined ?? "default"; // SyntaxError

   // 正确写法：使用括号明确优先级
   const result = (null || undefined) ?? "default"; // "default"
   ```

2. **赋值运算**

   ```javascript
   let x = null;
   x ??= "default"; // 等同于 x = x ?? "default";
   console.log(x); // "default"
   ```

3. **兼容性**
   - 现代浏览器（Chrome 80+、Firefox 74+、Safari 13.1+）均支持。
   - 旧浏览器（如 IE）需使用 Babel 等工具转译。

### 五、性能考量

- **执行效率**：空值合并运算符的性能与手动条件判断相当，不会引入显著开销。
- **代码可读性**：相比传统的 `if-else` 或三元表达式，`??` 使默认值逻辑更加简洁明了。

### 总结

空值合并运算符 `??` 是 JavaScript 中处理默认值的理想选择，尤其适合需要严格区分 `null/undefined` 和其他假值的场景。它与可选链操作符 `?.` 配合使用，能有效处理复杂嵌套结构中的缺失值，使代码更加健壮、简洁。在实际开发中，建议优先使用 `??` 替代 `||` 来设置默认值，以避免对合法假值的误判。
