

## 1. ä»€ä¹ˆæ˜¯ WeakMapï¼Ÿ

-  `WeakMap` æ˜¯ **ES6** å¼•å…¥çš„ä¸€ç§ç‰¹æ®Šçš„ `Map`ã€‚
-  å®ƒçš„ **é”®ï¼ˆkeyï¼‰å¿…é¡»æ˜¯å¯¹è±¡**ï¼ˆéå¯¹è±¡ä¼šæŠ¥é”™ï¼‰ã€‚
-  ä¸æ™®é€š `Map` çš„åŒºåˆ«æ˜¯ï¼š

   -  `WeakMap` çš„é”®æ˜¯ **å¼±å¼•ç”¨**ï¼Œä¸ä¼šé˜»æ­¢åƒåœ¾å›æ”¶ã€‚
   -  å½“å¯¹è±¡æ²¡æœ‰å…¶ä»–å¼•ç”¨æ—¶ï¼Œåƒåœ¾å›æ”¶å™¨ä¼šè‡ªåŠ¨æ¸…ç†è¿™ä¸ªå¯¹è±¡ä»¥åŠå¯¹åº”çš„é”®å€¼å¯¹ã€‚
   -  å› æ­¤ `WeakMap` **ä¸èƒ½è¢«éå†**ï¼Œä¹Ÿæ²¡æœ‰ `size` å±æ€§ã€‚

---

## 2. åŸºæœ¬ç”¨æ³•

```js
// åˆ›å»º WeakMap
const wm = new WeakMap();

const obj1 = { name: "Alice" };
const obj2 = { name: "Bob" };

// è®¾ç½®é”®å€¼å¯¹
wm.set(obj1, "å¼€å‘è€…");
wm.set(obj2, "è®¾è®¡å¸ˆ");

// è·å–
console.log(wm.get(obj1)); // "å¼€å‘è€…"

// åˆ¤æ–­æ˜¯å¦å­˜åœ¨
console.log(wm.has(obj2)); // true

// åˆ é™¤
wm.delete(obj2);
console.log(wm.has(obj2)); // false
```

âš ï¸ ä¸èƒ½ç”¨ `for...of`ã€`forEach`ã€`keys()`ã€`values()` éå†ï¼Œå› ä¸ºé”®ä¼šéšåƒåœ¾å›æ”¶è€Œæ¶ˆå¤±ã€‚

---

## 3. WeakMap çš„ç‰¹ç‚¹

1. **é”®å¿…é¡»æ˜¯å¯¹è±¡**

   ```js
   const wm = new WeakMap();
   wm.set(123, "num"); // âŒ æŠ¥é”™ï¼šInvalid value used as weak map key
   ```

2. **é”®æ˜¯å¼±å¼•ç”¨**

   -  `WeakMap` ä¸ä¼šé˜»æ­¢å¯¹è±¡è¢«åƒåœ¾å›æ”¶ã€‚
   -  å¦‚æœæŸä¸ªå¯¹è±¡ä¸å†è¢«å¼•ç”¨ï¼Œå®ƒä¼šè‡ªåŠ¨ä» `WeakMap` ä¸­æ¶ˆå¤±ã€‚

3. **ä¸å¯éå†**

   -  æ²¡æœ‰ `size`ã€æ²¡æœ‰ `clear()`ã€‚
   -  è®¾è®¡ç›®çš„æ˜¯ **é˜²æ­¢å†…å­˜æ³„æ¼**ã€‚

---

## 4. ä½¿ç”¨åœºæ™¯

### (1) ç»™å¯¹è±¡â€œç§æœ‰å±æ€§â€

```js
const privateData = new WeakMap();

class Person {
   constructor(name, age) {
      privateData.set(this, { name, age });
   }

   getName() {
      return privateData.get(this).name;
   }
}

const p1 = new Person("Tom", 20);
console.log(p1.getName()); // "Tom"

// å¤–éƒ¨æ— æ³•ç›´æ¥è®¿é—® name å’Œ age
```

ğŸ‘‰ ç”¨ `WeakMap` ç»™å¯¹è±¡å­˜å‚¨â€œç§æœ‰æ•°æ®â€ï¼Œå½“å¯¹è±¡é”€æ¯æ—¶ï¼Œæ•°æ®ä¹Ÿä¼šè‡ªåŠ¨æ¸…ç†ã€‚

---

### (2) å…³è”é¢å¤–æ•°æ®ï¼Œé¿å…å†…å­˜æ³„æ¼

```js
const wm = new WeakMap();

function setMetadata(obj, meta) {
   wm.set(obj, meta);
}

function getMetadata(obj) {
   return wm.get(obj);
}

let user = { id: 1 };
setMetadata(user, { loggedIn: true });

console.log(getMetadata(user)); // { loggedIn: true }

// å½“ user = null æ—¶ï¼Œè¿™ä¸ªå¯¹è±¡ä¼šè¢«åƒåœ¾å›æ”¶
user = null;
// WeakMap è‡ªåŠ¨æ¸…ç†å¯¹åº”çš„ { loggedIn: true }ï¼Œé¿å…å†…å­˜æ³„æ¼
```

---

## 5. å¯¹æ¯” `Map` å’Œ `WeakMap`

| ç‰¹æ€§      | Map                   | WeakMap                    |
| --------- | --------------------- | -------------------------- |
| é”®ç±»å‹    | ä»»æ„å€¼                | åªèƒ½æ˜¯å¯¹è±¡                 |
| å¼•ç”¨      | å¼ºå¼•ç”¨                | å¼±å¼•ç”¨                     |
| å¯éå†æ€§  | å¯éå†ï¼ˆkeys/valuesï¼‰ | ä¸å¯éå†                   |
| size å±æ€§ | æœ‰                    | æ²¡æœ‰                       |
| å†…å­˜ç®¡ç†  | å¯èƒ½å†…å­˜æ³„æ¼          | è‡ªåŠ¨åƒåœ¾å›æ”¶ï¼Œé¿å…å†…å­˜æ³„æ¼ |

---

âœ… æ€»ç»“ï¼š

-  **ç”¨ `WeakMap` å­˜æ”¾å¯¹è±¡çš„ç§æœ‰æ•°æ®æˆ–ä¸´æ—¶æ•°æ®**ï¼Œä¸ç”¨æ‹…å¿ƒå†…å­˜æ³„æ¼ã€‚
-  **ç”¨ `Map` å­˜æ”¾éœ€è¦éå†çš„é”®å€¼å¯¹**ã€‚

---

è¦ä¸è¦æˆ‘å¸®ä½ åšä¸€ä¸ª **WeakMap vs Map çš„å¯¹æ¯”åŠ¨å›¾/ASCII åŠ¨ç”»**ï¼Œæ¼”ç¤ºåƒåœ¾å›æ”¶æ—¶ WeakMap çš„é”®å€¼å¯¹æ˜¯å¦‚ä½•è‡ªåŠ¨æ¶ˆå¤±çš„ï¼Ÿ
