JavaScript 的 **可选链操作符（Optional Chaining）** `?.` 是 ES2020（ES11）引入的语法糖，用于在访问嵌套对象属性时**避免因中间值为 `null` 或 `undefined` 而导致的错误**。它提供了一种更安全的属性访问方式，尤其适合处理可能缺失的嵌套结构。以下是关于该操作符的全面总结：

### 一、基本语法

可选链操作符有三种形式：

1. **属性访问**：`obj?.prop`  
   如果 `obj` 为 `null` 或 `undefined`，直接返回 `undefined`，否则返回 `prop` 的值。

2. **方法调用**：`obj?.method()`  
   如果 `obj` 为 `null` 或 `undefined`，直接返回 `undefined`，否则调用 `method` 并返回结果。

3. **数组索引**：`arr?.[index]`  
   如果 `arr` 为 `null` 或 `undefined`，直接返回 `undefined`，否则返回指定索引的值。

### 二、核心特性

#### 1. **安全访问嵌套属性**

```javascript
const user = {
  profile: {
    name: "Alice",
  },
};

// 传统写法（需多次检查）
const oldName = user && user.profile && user.profile.name;

// 可选链写法（简洁安全）
const newName = user?.profile?.name;
console.log(newName); // "Alice"

// 当中间值缺失时
const email = user?.profile?.email;
console.log(email); // undefined（不会报错）
```

#### 2. **安全调用方法或函数**

```javascript
const obj = {
  greet: () => "Hello!",
};

// 传统写法
const oldResult = obj.greet && obj.greet();

// 可选链写法
const newResult = obj?.greet?.();
console.log(newResult); // "Hello!"

// 当方法不存在时
const missingResult = obj?.farewell?.();
console.log(missingResult); // undefined（不会报错）
```

#### 3. **安全访问数组索引**

```javascript
const arr = [10, 20, 30];

// 传统写法
const oldValue = arr && arr[0];

// 可选链写法
const newValue = arr?.[0];
console.log(newValue); // 10

// 当数组不存在时
const missingArray = null;
const safeValue = missingArray?.[0];
console.log(safeValue); // undefined（不会报错）
```

#### 4. **与空值合并操作符（??）结合**

```javascript
const user = {
  settings: {
    darkMode: false,
  },
};

// 获取 darkMode 值，若缺失则使用默认值 true
const mode = user?.settings?.darkMode ?? true;
console.log(mode); // false
```

### 三、与其他操作符的对比

| **操作符**        | **作用**                                                         | **示例**                  | **结果**                                        |
| ----------------- | ---------------------------------------------------------------- | ------------------------- | ----------------------------------------------- |
| **可选链 `?.`**   | 安全访问嵌套属性，中间值为 `null/undefined` 时返回 `undefined`。 | `obj?.a?.b`               | `undefined`（若 `obj` 或 `a` 缺失）             |
| **逻辑与 `&&`**   | 用于条件判断，返回第一个假值或最后一个真值。                     | `obj && obj.a && obj.a.b` | `undefined`（若 `obj` 或 `a` 缺失）             |
| **空值合并 `??`** | 仅当左侧为 `null/undefined` 时返回右侧默认值。                   | `obj.a.b ?? 'default'`    | `'default'`（若 `obj.a.b` 为 `null/undefined`） |

### 四、常见应用场景

#### 1. **API 响应处理**

```javascript
// 假设 API 返回可能缺少某些字段的对象
const response = {
  data: {
    user: {
      name: "Bob",
    },
  },
};

// 安全获取嵌套数据
const userName = response?.data?.user?.name;
const userAge = response?.data?.user?.age ?? 18;
```

#### 2. **DOM 操作**

```javascript
// 安全获取可能不存在的 DOM 元素
const element = document.querySelector("#my-element");
const text = element?.textContent ?? "Default Text";
```

#### 3. **函数参数处理**

```javascript
function processData(options) {
  // 安全访问 options 中的嵌套属性
  const value = options?.config?.value ?? 0;
  return value * 2;
}

processData({}); // 0（不会报错）
```

### 五、注意事项

1. **不可用于赋值左侧**

   ```javascript
   obj?.a = 10; // 报错：可选链不能用于赋值左侧
   ```

2. **仅检查 `null` 和 `undefined`**
   其他假值（如 `0`、`false`、空字符串）不会触发短路：

   ```javascript
   const obj = { count: 0 };
   console.log(obj?.count); // 0（正常返回，因为 0 不是 null/undefined）
   ```

3. **与括号结合时的优先级**

   ```javascript
   const arr = null;
   console.log(arr?.[0] || 100); // 100（先计算可选链，再执行逻辑或）
   ```

4. **兼容性**
   - 现代浏览器（Chrome 80+、Firefox 74+、Safari 13.1+）均支持。
   - 旧浏览器（如 IE）需使用 Babel 等工具转译。

### 六、性能考量

- **执行效率**：可选链操作符的性能与手动检查相当，不会引入显著开销。
- **代码可读性**：大幅减少嵌套条件判断，提升代码简洁性和可维护性。
