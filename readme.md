# OSI 七层模型

# TCP/IP 参考模型

### 1. DNS 协议

**DNS 查询过程**

典型流程（递归查询）：

1. 浏览器缓存

   - 先查本地浏览器缓存（Chrome 默认 60s 左右）。

2. 操作系统缓存

   - OS 会维护一张 DNS 缓存表。

3. 本地域名服务器（LDNS，运营商提供）

   - 若缓存命中，直接返回。

4. 根域名服务器

   - 返回顶级域名（TLD，如 `.com`）服务器地址。

5. 顶级域名服务器

   - 返回权威域名服务器地址。

6. 权威域名服务器

   - 返回最终的 IP 地址。

7. 客户端缓存结果，下次直接用。

### 2.

# TCP 和 UDP

### TCP 和 UDP 的基本区别

| 特性         | TCP                                      | UDP                                           |
| ------------ | ---------------------------------------- | --------------------------------------------- |
| **连接方式** | 面向连接（三次握手、四次挥手）           | 无连接（发包即走）                            |
| **可靠性**   | 提供可靠传输（有确认、有重传、顺序保证） | 不保证可靠传输（可能丢包、乱序）              |
| **传输顺序** | 保证顺序                                 | 不保证顺序                                    |
| **速度**     | 较慢（有握手确认）                       | 较快（无额外开销）                            |
| **开销**     | 较大（20B TCP 头部 + 选项）              | 较小（8B UDP 头部）                           |
| **应用场景** | 需要可靠传输：HTTP、HTTPS、SMTP、FTP     | 实时性要求高：视频直播、DNS、VoIP、游戏、QUIC |

### TCP 的核心机制

1. **三次握手（连接建立）**

   - SYN → SYN+ACK → ACK
   - 确保双方建立可靠连接，避免历史连接干扰。

2. **四次挥手（连接释放）**

   - 双方都要确认关闭，避免数据丢失。

3. **可靠传输**

   - **序列号（Seq）+ 确认号（Ack）**
   - 丢包重传（超时重传 + 快速重传）
   - 滑动窗口（流量控制）

4. **拥塞控制**

   - 慢启动、拥塞避免、快速重传、快速恢复
   - 避免网络过载

5. **流量控制**

   - 根据接收方缓冲区动态调整发送速率（避免“推倒墙”）

### UDP 的核心特点

1. **无连接**

   - 不建立连接，减少开销
   - 每个数据报独立发送

2. **尽力而为**

   - 不保证送达、不保证顺序、不保证无重复

3. **轻量**

   - 报头只有 8 个字节，包含：源端口、目标端口、长度、校验和

4. **应用层协议可自定义可靠性**

   - 例如：QUIC 基于 UDP，但自己实现了可靠传输

### **Q: TCP 三次握手为什么不是两次？**

A: 两次无法保证客户端确认自己和服务端的收发能力正常，容易出现“旧连接请求”问题。

### **Q: TCP 四次挥手为什么不是三次？**

A: 关闭需要双方都确认，TCP 是全双工的，两边都要单独关闭发送方向。

### **Q: TCP 如何保证可靠传输？**

A: 序号 + 确认应答 + 超时重传 + 滑动窗口 + 流量控制 + 拥塞控制。

### **Q: UDP 为什么更快？**

A: 没有握手、确认、重传机制，报头小，开销少。

### **Q: HTTP/3 为什么基于 UDP？**

A: 避免 TCP 队头阻塞，支持更灵活的多路复用和 0-RTT 连接。

# HTTP

### 使用 HTTP 长连接有哪些优点？

1. **减少 TCP 握手开销**

   - 普通的短连接每次请求都要经历 **三次握手 + 四次挥手**，在高并发场景下非常耗时。
   - 长连接可以在同一个 TCP 连接上复用多个 HTTP 请求，避免了频繁建立和关闭连接的开销。

2. **降低网络延迟（提升性能）**

   - 请求数据时不需要每次都重新建立 TCP 连接，可以显著减少响应时间。
   - 对于小文件、多请求场景（例如网页加载中有大量图片、CSS、JS 文件），性能提升明显。

3. **节省带宽资源**

   - 建立和关闭 TCP 连接需要额外的包（如 SYN、FIN、ACK），长连接减少了这些额外的传输，节省了带宽。

4. **提升服务器和客户端的吞吐量**

   - 由于减少了连接建立/释放的系统调用和资源消耗，服务器可以处理更多请求，客户端也能更快完成页面加载。

5. **便于实现管道化与复用**（特别在 HTTP/1.1 和 HTTP/2）

   - 在同一个长连接上可以并行或流水线式地发送多个请求（HTTP/1.1 的 Pipelining，HTTP/2 的多路复用），避免“队头阻塞”问题，提高并发效率。

👉 总结：
**HTTP 长连接的核心优点就是：减少握手/挥手开销、降低延迟、节省带宽、提高整体性能和并发能力。**

### TLS/SSL 协议

**核心安全目标**

TLS/SSL 协议主要解决三个安全问题：

1. **保密性（Confidentiality）**
   防止数据被中间人窃听。

   - 通过对数据进行**加密**来实现，只有通信双方可以解密数据。

2. **完整性（Integrity）**
   防止数据被篡改。

   - 使用**消息认证码（MAC）**或哈希函数验证数据是否被修改。

3. **身份验证（Authentication）**
   确认通信的对方是合法实体。

   - 通过**数字证书和公钥基础设施（PKI）**验证服务器或客户端身份。

### 2. **TLS/SSL 的工作流程**

**步骤 1：客户端发起连接（ClientHello）**

- 客户端向服务器发送：

  - 支持的 TLS 版本
  - 支持的加密套件（加密算法组合）
  - 一个随机数（Client Random，用于后续密钥生成）
    **步骤 2：服务器回应（ServerHello）**

- 服务器选择：

  - TLS 版本
  - 加密套件
  - 另一个随机数（Server Random）

- 同时发送 **服务器证书**（含公钥）

  - 证书由可信的 CA 签名，保证服务器身份真实可靠。

  **步骤 3：密钥协商**

TLS 支持几种密钥交换方式，最常用的是 **RSA 和 Diffie-Hellman (DH/ECDH)**：

1. **RSA**：

   - 客户端生成一个随机“会话密钥”（Session Key），用服务器公钥加密发送给服务器。
   - 服务器用自己的私钥解密，得到会话密钥。

2. **DH/ECDH（推荐）**：

   - 客户端和服务器各自生成一个临时密钥对
   - 通过交换公钥并计算共享密钥（Shared Secret）
   - 即使有人监听公钥，也无法算出共享密钥。

> **最终目标**：客户端和服务器共享同一个**对称加密密钥**，用于后续通信。

**步骤 4：双方确认加密通信**

- 双方使用生成的会话密钥，发送一条加密的**Finished**消息，确认密钥正确。
- 从此，通信全部使用对称加密（AES、ChaCha20 等），保证数据保密性和效率。

### TLS/SSL 协议为什么安全

1. **中间人无法解密**：

   - 会话密钥只在客户端和服务器之间生成，任何监听者都无法获取。

2. **防篡改**：

   - 数据传输时附带 MAC，篡改数据会导致验证失败。

3. **防冒充**：

   - 服务器证书由可信 CA 签发，中间人难以伪造。

# other

### 什么是多播

- **单播（Unicast）**：点对点，一个源主机 → 一个目标主机。
- **广播（Broadcast）**：一个源主机 → 同一网络内所有主机。
- **多播（Multicast）**：一个源主机 → 一组特定的接收主机（加入同一个多播组的主机）。

多播的好处是：只发一次数据，网络会复制转发给多个接收者，比单播节省带宽，比广播更有针对性。
