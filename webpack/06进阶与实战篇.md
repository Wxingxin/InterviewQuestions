è¿™ç»„é¢˜å±äº **Webpack å®æˆ˜é…ç½®ä¸é¡¹ç›®åº”ç”¨** çš„è¿›é˜¶é¢è¯•é¢˜ï¼Œé‡ç‚¹è€ƒå¯Ÿä½ åœ¨å®é™…é¡¹ç›®ä¸­å¯¹ Webpack çš„é…ç½®èƒ½åŠ›ã€‚ä¸‹é¢æˆ‘ä¸ºä½ é€æ¡è¯¦ç»†è§£æï¼Œå¹¶ç»™å‡ºé…ç½®ç¤ºä¾‹å’Œé¢è¯•è¦ç‚¹ã€‚

---

## **1ï¸âƒ£ å¦‚ä½•åœ¨ Webpack ä¸­é…ç½®ç¯å¢ƒå˜é‡ï¼Ÿ**

Webpack å¯ä»¥é€šè¿‡ **DefinePlugin** æ³¨å…¥ç¯å¢ƒå˜é‡åˆ°ä»£ç ä¸­ã€‚

### ğŸ“˜ é…ç½®ç¤ºä¾‹

```js
const webpack = require('webpack');

module.exports = {
  plugins: [
    new webpack.DefinePlugin({
      'process.env.NODE_ENV': JSON.stringify(process.env.NODE_ENV || 'development'),
      'process.env.API_BASE_URL': JSON.stringify('https://api.example.com'),
    }),
  ],
};
```

### âœ… æ³¨æ„ç‚¹

* `DefinePlugin` æ˜¯æ–‡æœ¬æ›¿æ¢ï¼Œä¸æ˜¯æ³¨å…¥å˜é‡ï¼›
* é€šå¸¸é…åˆ `.env` æ–‡ä»¶ä½¿ç”¨ `dotenv` åŠ è½½ã€‚

---

## **2ï¸âƒ£ å¦‚ä½•è®© Webpack æ”¯æŒ CSS/SCSS/LESSï¼Ÿ**

Webpack é€šè¿‡ **Loader** å¤„ç†æ ·å¼æ–‡ä»¶ã€‚

### ğŸ“˜ é…ç½®ç¤ºä¾‹

```js
module.exports = {
  module: {
    rules: [
      // CSS
      { test: /\.css$/, use: ['style-loader', 'css-loader'] },
      // SCSS
      { test: /\.scss$/, use: ['style-loader', 'css-loader', 'sass-loader'] },
      // LESS
      { test: /\.less$/, use: ['style-loader', 'css-loader', 'less-loader'] },
    ],
  },
};
```

* **style-loader**ï¼šæŠŠ CSS æ³¨å…¥åˆ° DOM ä¸­ï¼›
* **css-loader**ï¼šè§£æ `@import` å’Œ `url()`ï¼›
* **sass-loader / less-loader**ï¼šç¼–è¯‘ SCSS / LESSã€‚

---

## **3ï¸âƒ£ å¦‚ä½•æå–å…¬å…±ä»£ç ï¼ˆSplitChunksPluginï¼‰ï¼Ÿ**

Webpack 5 å†…ç½® **SplitChunksPlugin**ï¼Œç”¨äºæå–å…¬å…±æ¨¡å—ï¼Œå‡å°‘é‡å¤ä»£ç ã€‚

### ğŸ“˜ é…ç½®ç¤ºä¾‹

```js
module.exports = {
  optimization: {
    splitChunks: {
      chunks: 'all', // all: åŒæ­¥ + å¼‚æ­¥æ¨¡å—éƒ½åˆ†å‰²
      cacheGroups: {
        vendors: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendors',
          chunks: 'all',
        },
        commons: {
          test: /[\\/]src[\\/]components[\\/]/,
          name: 'commons',
          minChunks: 2,
        },
      },
    },
  },
};
```

âœ… ä¼˜ç‚¹ï¼š

* é¿å…é‡å¤æ‰“åŒ…ç¬¬ä¸‰æ–¹åº“ï¼›
* æå‡ç¼“å­˜åˆ©ç”¨ç‡ï¼›
* å‡å°‘ä¸» bundle ä½“ç§¯ã€‚

---

## **4ï¸âƒ£ å¦‚ä½•é…ç½®å›¾ç‰‡ã€å­—ä½“ç­‰é™æ€èµ„æºï¼Ÿ**

Webpack 5 æ¨èä½¿ç”¨ **Asset Modules**ï¼Œæ— éœ€é¢å¤– loaderã€‚

### ğŸ“˜ é…ç½®ç¤ºä¾‹

```js
module.exports = {
  module: {
    rules: [
      {
        test: /\.(png|jpe?g|gif|svg)$/i,
        type: 'asset', // è‡ªåŠ¨é€‰æ‹© inline / resource
        parser: { dataUrlCondition: { maxSize: 8 * 1024 } }, // å°äº 8KB inline
      },
      {
        test: /\.(woff2?|eot|ttf|otf)$/i,
        type: 'asset/resource',
      },
    ],
  },
};
```

* `asset/resource` â†’ ç”Ÿæˆæ–‡ä»¶ï¼›
* `asset/inline` â†’ å†…è” base64ï¼›
* `asset` â†’ è‡ªåŠ¨é€‰æ‹©ã€‚

---

## **5ï¸âƒ£ å¦‚ä½•ä½¿ç”¨ Babel ä¼˜åŒ–è€æ—§æµè§ˆå™¨å…¼å®¹ï¼Ÿ**

ä½¿ç”¨ **@babel/preset-env** + `useBuiltIns: 'usage'` é…åˆ `core-js` è‡ªåŠ¨æ³¨å…¥ polyfillã€‚

### ğŸ“˜ é…ç½®ç¤ºä¾‹

```bash
npm install @babel/core babel-loader @babel/preset-env core-js -D
```

```js
module.exports = {
  module: {
    rules: [
      {
        test: /\.js$/,
        use: {
          loader: 'babel-loader',
          options: {
            presets: [
              ['@babel/preset-env', {
                useBuiltIns: 'usage',
                corejs: 3,
                targets: "> 0.25%, not dead",
              }],
            ],
          },
        },
      },
    ],
  },
};
```

âœ… ä¼˜ç‚¹ï¼š

* è‡ªåŠ¨æ ¹æ®ç›®æ ‡æµè§ˆå™¨æ³¨å…¥ polyfillï¼›
* å‡å°‘å†—ä½™ä»£ç ã€‚

---

## **6ï¸âƒ£ å¦‚ä½•åœ¨ Webpack ä¸­å¼€å¯ gzip å‹ç¼©ï¼Ÿ**

ä½¿ç”¨ **compression-webpack-plugin**ã€‚

### ğŸ“˜ é…ç½®ç¤ºä¾‹

```bash
npm install compression-webpack-plugin -D
```

```js
const CompressionPlugin = require('compression-webpack-plugin');

module.exports = {
  plugins: [
    new CompressionPlugin({
      test: /\.(js|css)$/,
      algorithm: 'gzip',
      threshold: 10240,
      minRatio: 0.8,
    }),
  ],
};
```

âœ… æ³¨æ„ï¼š

* ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼›
* æœåŠ¡å™¨éœ€é…ç½®è¯»å– `.gz` æ–‡ä»¶æˆ–å¯ç”¨å‹ç¼©ä¼ è¾“ã€‚

---

## **7ï¸âƒ£ å¦‚ä½•ä½¿ç”¨ Webpack é…ç½® React/Vue é¡¹ç›®ï¼Ÿ**

### React

```bash
npm install react react-dom @babel/preset-react babel-loader -D
```

```js
module.exports = {
  module: {
    rules: [
      {
        test: /\.jsx?$/,
        use: 'babel-loader',
        exclude: /node_modules/,
      },
    ],
  },
  resolve: { extensions: ['.js', '.jsx'] },
};
```

### Vue

```bash
npm install vue vue-loader vue-template-compiler -D
```

```js
const { VueLoaderPlugin } = require('vue-loader');
module.exports = {
  module: {
    rules: [{ test: /\.vue$/, loader: 'vue-loader' }],
  },
  plugins: [new VueLoaderPlugin()],
};
```

---

## **8ï¸âƒ£ å¦‚ä½•ç”¨ Webpack å®ç° SSRï¼ˆæœåŠ¡ç«¯æ¸²æŸ“ï¼‰ï¼Ÿ**

Webpack å¯ä»¥æ‰“åŒ…æœåŠ¡ç«¯å…¥å£ï¼š

* target: `node`
* è¾“å‡ºæ¨¡å—ç±»å‹: `commonjs2`

### ğŸ“˜ ç¤ºä¾‹

```js
module.exports = {
  target: 'node',
  entry: './src/server.js',
  output: {
    path: __dirname + '/dist',
    filename: 'server.js',
    libraryTarget: 'commonjs2',
  },
  module: { rules: [/* js/ts loader */] },
};
```

âœ… é…åˆ Node æœåŠ¡å™¨ï¼š

* å®¢æˆ·ç«¯ bundle è´Ÿè´£å‰ç«¯æ¸²æŸ“ï¼›
* æœåŠ¡ç«¯ bundle è´Ÿè´£ç”Ÿæˆ HTML å¹¶å‘é€ç»™æµè§ˆå™¨ã€‚

---

## **9ï¸âƒ£ å¦‚ä½•ä½¿ç”¨ Webpack æ‰“åŒ…åº“ï¼ˆlibraryï¼‰ï¼Ÿ**

### ğŸ“˜ é…ç½®ç¤ºä¾‹

```js
module.exports = {
  entry: './src/index.js',
  output: {
    path: __dirname + '/dist',
    filename: 'my-lib.js',
    library: 'MyLib', // å…¨å±€å˜é‡å
    libraryTarget: 'umd', // æ”¯æŒ CommonJSã€AMDã€å…¨å±€å˜é‡
    globalObject: 'this',
  },
};
```

âœ… æ³¨æ„ï¼š

* libraryTarget æ”¯æŒå¤šç§æ¨¡å—è§„èŒƒï¼ˆUMD é€šç”¨åº“ï¼‰ï¼›
* å¯ä»¥é€šè¿‡ externals æ’é™¤ä¾èµ–ï¼Œå‡å°ä½“ç§¯ã€‚

---

## **ğŸ”Ÿ å¦‚ä½•åœ¨ Webpack ä¸­é›†æˆ ESLintã€Prettierï¼Ÿ**

### ESLint

```bash
npm install eslint eslint-loader -D
```

```js
module: {
  rules: [
    { test: /\.js$/, enforce: 'pre', use: 'eslint-loader', exclude: /node_modules/ }
  ],
},
```

### Prettier

* é…åˆ eslint æ’ä»¶ `eslint-config-prettier`ï¼Œä¿è¯æ ¼å¼åŒ–è§„åˆ™ä¸å†²çªï¼›
* å¯åœ¨ IDE æˆ– git hookï¼ˆhusky + lint-stagedï¼‰ä¸­è‡ªåŠ¨æ‰§è¡Œã€‚

```json
// .eslintrc
{
  "extends": ["eslint:recommended", "plugin:prettier/recommended"]
}
```

---

### ğŸ”‘ **é¢è¯•è¦ç‚¹æ€»ç»“**

* èƒ½åŒºåˆ†**å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒ**çš„ä¼˜åŒ–æ‰‹æ®µï¼›
* ç†Ÿæ‚‰ **loader / plugin** çš„ä½œç”¨ï¼›
* çŸ¥é“å¦‚ä½•å¤„ç†é™æ€èµ„æºã€æ ·å¼ã€JS è¯­æ³•å…¼å®¹ï¼›
* èƒ½å®ç° **ä»£ç åˆ†å‰²ã€gzipã€SSRã€åº“æ‰“åŒ…** ç­‰è¿›é˜¶éœ€æ±‚ï¼›
* èƒ½é›†æˆ **ä»£ç è§„èŒƒå·¥å…·** æå‡å›¢é˜Ÿåä½œæ•ˆç‡ã€‚

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥å¸®ä½ æŠŠè¿™å››å¥—é¢˜ï¼ˆ30 + 10 + 10 + 10ï¼Œå…± 60 é“ï¼‰æ•´ç†æˆ
ğŸ“˜ã€ŠWebpack é¢è¯•å…¨å¥—æ‰‹å†Œã€‹PDFç‰ˆ

* æ¯é¢˜è¦ç‚¹ + é…ç½®ç¤ºä¾‹ + åŸç†è§£æ
* å¯æ‰“å°æˆ–å¯¼å…¥ Notion å­¦ä¹ 
* å¸¦å›¾è§£ HMRã€æ¨¡å—åŠ è½½ã€Tree Shaking

è¦æˆ‘å¸®ä½ æ’ç‰ˆå¯¼å‡ºå—ï¼Ÿ
