## **1ï¸âƒ£ å¦‚ä½•ä¼˜åŒ– Webpack çš„æ„å»ºé€Ÿåº¦ï¼Ÿ**

æ„å»ºé€Ÿåº¦ä¼˜åŒ–æ ¸å¿ƒæ€è·¯æ˜¯ï¼šâ€œ**å‡å°‘è¦ç¼–è¯‘çš„å†…å®¹ + æé«˜ç¼–è¯‘æ•ˆç‡ + åˆ©ç”¨ç¼“å­˜**â€ã€‚

### âœ… å¸¸ç”¨æ‰‹æ®µï¼š

| ä¼˜åŒ–æ–¹å‘                  | æ–¹æ³•                                    | ç¤ºä¾‹                            |
| ------------------------- | --------------------------------------- | ------------------------------- |
| **1. ç¼“å­˜**               | å¯ç”¨æŒä¹…åŒ–ç¼“å­˜                          | `cache: { type: 'filesystem' }` |
| **2. å¤šè¿›ç¨‹æ„å»º**         | ä½¿ç”¨ `thread-loader` æˆ– `HappyPack`     | JS/TS è½¬è¯‘å¹¶è¡Œ                  |
| **3. ç¼©å°ç¼–è¯‘èŒƒå›´**       | é…ç½® `include/exclude`ã€`resolve.alias` | å‡å°‘æ–‡ä»¶æœç´¢è·¯å¾„                |
| **4. åˆç†ä½¿ç”¨ SourceMap** | å¼€å‘ä½¿ç”¨ `cheap-module-source-map`      | å‡å°‘æ˜ å°„ç”Ÿæˆæ—¶é—´                |
| **5. å…³é—­æ— ç”¨æ’ä»¶**       | ä»…åœ¨ç”Ÿäº§ä½¿ç”¨å¦‚ `MiniCssExtractPlugin`   |                                 |
| **6. ä½¿ç”¨ DLLï¼ˆè€æ–¹æ³•ï¼‰** | å°†ä¸å˜ä¾èµ–æå‰ç¼–è¯‘                      | `DllPlugin`                     |
| **7. ä½¿ç”¨æ›´å¿«ç¼–è¯‘å™¨**     | ä½¿ç”¨ `esbuild-loader` / `swc-loader`    | æ›¿ä»£ Babel æé€Ÿ 10x             |

---

## **2ï¸âƒ£ å¦‚ä½•ä¼˜åŒ– Webpack çš„æ‰“åŒ…ä½“ç§¯ï¼Ÿ**

æ ¸å¿ƒç›®æ ‡ï¼šâ€œ**è®©æœ€ç»ˆäº§ç‰©æ›´å°ã€æ›´å°‘ã€æ›´é«˜æ•ˆ**â€ã€‚

### âœ… ä¼˜åŒ–æ–¹æ³•ï¼š

| ä¼˜åŒ–æ–¹å‘              | æ–¹æ³•                                  | ç¤ºä¾‹                                    |
| --------------------- | ------------------------------------- | --------------------------------------- |
| **1. Tree Shaking**   | æ¸…é™¤æ— ç”¨ä»£ç                           | å†…ç½®äºç”Ÿäº§æ¨¡å¼                          |
| **2. ä»£ç åˆ†å‰²**       | `SplitChunksPlugin`                   | æå–å…¬å…±ä¾èµ–                            |
| **3. å‹ç¼©ä»£ç **       | `TerserPlugin` + `CssMinimizerPlugin` | å»æ‰æ³¨é‡Š/ç©ºæ ¼                           |
| **4. å›¾ç‰‡ä¼˜åŒ–**       | `image-minimizer-webpack-plugin`      | WebP å‹ç¼©                               |
| **5. æŒ‰éœ€åŠ è½½**       | åŠ¨æ€ import + è·¯ç”±æ‡’åŠ è½½              | Vue/React åˆ†é¡µåŠ è½½                      |
| **6. externals**      | æ’é™¤å¤–éƒ¨åº“                            | CDN åŠ è½½ React/Vue                      |
| **7. ä½¿ç”¨ CDN**       | å°†èµ„æºæ”¾åœ¨ CDN ä¸Š                     | å‡å°‘ä¸»åŒ…ä½“ç§¯                            |
| **8. Scope Hoisting** | æ¨¡å—åˆå¹¶                              | `optimization.concatenateModules: true` |

---

## **3ï¸âƒ£ ä»€ä¹ˆæ˜¯ Tree Shakingï¼Ÿå®ç°åŸç†ï¼Ÿ**

> Tree Shaking æ˜¯ä¸€ç§**æ¶ˆé™¤æœªä½¿ç”¨ä»£ç ï¼ˆDead Code Eliminationï¼‰**çš„æŠ€æœ¯ã€‚

### âœ¨ å®ç°åŸç†ï¼š

1. **ESM é™æ€åˆ†æ**
   Webpack é€šè¿‡åˆ†æ ES Moduleï¼ˆ`import/export`ï¼‰è¯­æ³•ï¼Œè¯†åˆ«å“ªäº›å¯¼å‡ºæœªè¢«ä½¿ç”¨ï¼›
2. **æ ‡è®°æœªä½¿ç”¨ä»£ç **ï¼ˆæ ‡è®°ä¸º `/* unused harmony export */`ï¼‰ï¼›
3. **Terser ç­‰å‹ç¼©å·¥å…·åœ¨å‹ç¼©é˜¶æ®µåˆ é™¤æ— ç”¨ä»£ç ã€‚**

```js
// utils.js
export function used() {}
export function unused() {}

// index.js
import { used } from "./utils";
used();
```

æ‰“åŒ…ååªä¿ç•™ `used()`ã€‚

---

## **4ï¸âƒ£ Tree Shaking æœ‰å“ªäº›å±€é™æ€§ï¼Ÿ**

| å±€é™æ€§                   | åŸå›                                                              |
| ------------------------ | ---------------------------------------------------------------- |
| **å¿…é¡»ä½¿ç”¨ ES Module**   | å› ä¸ºåªæœ‰ ESM æ˜¯é™æ€å¯åˆ†æçš„ï¼Œ`require` æ˜¯åŠ¨æ€çš„                  |
| **å‰¯ä½œç”¨æ–‡ä»¶æ— æ³•æ‘‡æ‰**   | è‹¥æ–‡ä»¶æœ‰å‰¯ä½œç”¨ï¼ˆå¦‚å…¨å±€ä¿®æ”¹ï¼‰ï¼ŒWebpack ä¸ä¼šåˆ é™¤                   |
| **åŠ¨æ€å¼•å…¥éš¾åˆ†æ**       | å¦‚ `import('module_' + name)` æ— æ³•é™æ€ç¡®å®š                       |
| **ç¬¬ä¸‰æ–¹åº“æœªå£°æ˜å‰¯ä½œç”¨** | å¿…é¡»åœ¨ `package.json` ä¸­é…ç½® `"sideEffects": false` æ‰èƒ½å®Œå…¨ç”Ÿæ•ˆ |

---

## **5ï¸âƒ£ ä»€ä¹ˆæ˜¯ä»£ç åˆ†å‰²ï¼ˆCode Splittingï¼‰ï¼Ÿ**

> ä»£ç åˆ†å‰²æ˜¯å°†é¡¹ç›®æ‰“åŒ…ä¸ºå¤šä¸ª bundleï¼Œä»¥ä¾¿æŒ‰éœ€åŠ è½½ã€å‡å°‘é¦–å±ä½“ç§¯ã€‚

### ğŸ’¡ å®ç°æ–¹å¼ï¼š

1. **å¤šå…¥å£æ‰“åŒ…**

   ```js
   entry: {
     home: './src/home.js',
     about: './src/about.js',
   }
   ```

2. **åŠ¨æ€å¯¼å…¥ï¼ˆDynamic Importï¼‰**

   ```js
   import("./login").then((m) => m.init());
   ```

3. **SplitChunksPlugin è‡ªåŠ¨åˆ†å‰²**

   ```js
   optimization: {
     splitChunks: {
       chunks: 'all',
     },
   }
   ```

---

## **6ï¸âƒ£ å¦‚ä½•é…ç½®åŠ¨æ€å¯¼å…¥ï¼ˆDynamic Importï¼‰ï¼Ÿ**

åŠ¨æ€å¯¼å…¥ä½¿ç”¨ **import() å‡½æ•°è¯­æ³•**ï¼ŒWebpack è‡ªåŠ¨åˆ†åŒ…ã€‚

```js
// example.js
button.onclick = () => {
  import("./dialog").then(({ openDialog }) => openDialog());
};
```

é…ç½®ï¼ˆä»…éœ€ Babel æ”¯æŒï¼‰ï¼š

```bash
npm install @babel/plugin-syntax-dynamic-import -D
```

Webpack ä¼šè‡ªåŠ¨å°† `./dialog` ç”Ÿæˆä¸ºç‹¬ç«‹ chunkã€‚

---

## **7ï¸âƒ£ å¦‚ä½•å¼€å¯æŒä¹…åŒ–ç¼“å­˜ï¼ˆPersistent Cachingï¼‰ï¼Ÿ**

Webpack 5 å¼€ç®±å³ç”¨æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼š

```js
module.exports = {
  cache: {
    type: "filesystem", // å¯ç”¨æ–‡ä»¶ç³»ç»Ÿç¼“å­˜
    buildDependencies: {
      config: [__filename], // å½“é…ç½®æ–‡ä»¶æ”¹åŠ¨æ—¶æ¸…é™¤ç¼“å­˜
    },
  },
};
```

âœ¨ ä¼˜ç‚¹ï¼š

- äºŒæ¬¡æ„å»ºé€Ÿåº¦æå‡ 70%+
- è‡ªåŠ¨ç¼“å­˜ loaderã€æ’ä»¶ç»“æœ
- æ”¯æŒè·¨è¿›ç¨‹å…±äº«ç¼“å­˜

---

## **8ï¸âƒ£ å¦‚ä½•åˆ©ç”¨ `externals` ä¼˜åŒ–æ„å»ºï¼Ÿ**

> `externals` ç”¨äº**æ’é™¤ä¸å¸Œæœ›è¢«æ‰“åŒ…è¿› bundle çš„ä¾èµ–**ï¼Œè®©å…¶åœ¨è¿è¡Œæ—¶é€šè¿‡ CDN æˆ–å…¨å±€å˜é‡æä¾›ã€‚

```js
// webpack.config.js
externals: {
  react: 'React',
  'react-dom': 'ReactDOM',
}
```

ç„¶ååœ¨ HTML ä¸­æ‰‹åŠ¨å¼•å…¥ï¼š

```html
<script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
```

âœ… ä¼˜ç‚¹ï¼š

- å‡å°‘ bundle ä½“ç§¯ï¼›
- é¿å…é‡å¤æ‰“åŒ… React/Vueï¼›
- æå‡æ‰“åŒ…é€Ÿåº¦ã€‚

---

## **9ï¸âƒ£ ä»€ä¹ˆæ˜¯æ‡’åŠ è½½ï¼ˆLazy Loadingï¼‰ï¼Ÿ**

> æ‡’åŠ è½½æ˜¯ä¸€ç§ **æŒ‰éœ€åŠ è½½èµ„æº** çš„æŠ€æœ¯ï¼Œä»…åœ¨éœ€è¦æ—¶æ‰åŠ è½½å¯¹åº”æ¨¡å—ã€‚

å…¸å‹åœºæ™¯ï¼š

- è·¯ç”±æ‡’åŠ è½½ï¼›
- å›¾ç‰‡æ‡’åŠ è½½ï¼›
- ç»„ä»¶æŒ‰éœ€åŠ è½½ã€‚

ğŸ“˜ ç¤ºä¾‹ï¼ˆReactï¼‰ï¼š

```js
import React, { lazy, Suspense } from "react";

const Profile = lazy(() => import("./Profile"));

function App() {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <Profile />
    </Suspense>
  );
}
```

Webpack ä¼šä¸º `Profile` ç”Ÿæˆç‹¬ç«‹ chunkã€‚

---

## **ğŸ”Ÿ å¦‚ä½•å‡å°‘é‡å¤ä»£ç å’Œä¾èµ–ï¼Ÿ**

| æ–¹æ³•                    | è¯´æ˜                                    |
| ----------------------- | --------------------------------------- |
| **SplitChunksPlugin**   | è‡ªåŠ¨æŠ½ç¦»å…¬å…±æ¨¡å—                        |
| **externals**           | æå–ç¬¬ä¸‰æ–¹åº“åˆ° CDN                      |
| **å»é™¤é‡å¤ä¾èµ–ç‰ˆæœ¬**    | ä½¿ç”¨ `npm dedupe` æˆ– `yarn-deduplicate` |
| **ä½¿ç”¨ alias ç»Ÿä¸€ä¾èµ–** | é¿å… `react`ã€`react-dom` ç‰ˆæœ¬é‡å¤      |
| **Scope Hoisting**      | æå‡è¿è¡Œæ•ˆç‡ã€å‡å°‘åŒ…è£¹å±‚                |
| **åŠ¨æ€å¯¼å…¥**            | æŒ‰éœ€åŠ è½½å‡å°‘ä¸»åŒ…ä½“ç§¯                    |

```js
optimization: {
  splitChunks: {
    chunks: 'all',
    cacheGroups: {
      vendor: {
        test: /[\\/]node_modules[\\/]/,
        name: 'vendors',
        chunks: 'all',
      },
    },
  },
}
```

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥å¸®ä½ æŠŠè¿™ä¸¤å¥—é¢˜ï¼ˆä¸Šæ¬¡é‚£ 10 é¢˜ + è¿™æ¬¡è¿™ 10 é¢˜ï¼‰æ•´ç†æˆä¸€ä»½
ğŸ“˜ã€ŠWebpack é¢è¯•é€šå…³æ‰‹å†Œï¼ˆé™„ç¤ºä¾‹ä»£ç ï¼‰ã€‹PDFï¼Œç»“æ„æ¸…æ™°å¯æ‰“å°ï¼Œä½ è¦æˆ‘å¸®ä½ æ’ç‰ˆå¯¼å‡ºå—ï¼Ÿ
