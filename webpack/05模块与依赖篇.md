## **1ï¸âƒ£ Webpack å¦‚ä½•å¤„ç† ESModule å’Œ CommonJS æ··ç”¨ï¼Ÿ**

Webpack å†…éƒ¨åœ¨è§£ææ¨¡å—æ—¶ï¼Œä¸åŒºåˆ† ESM æˆ– CommonJSã€‚
åœ¨æ„å»ºé˜¶æ®µï¼ŒWebpack ä¼šé€šè¿‡ ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰åˆ†æä¸¤è€…çš„å¯¼å…¥å¯¼å‡ºï¼Œå¹¶å°†å®ƒä»¬éƒ½**ç»Ÿä¸€å°è£…æˆ Webpack è‡ªå®šä¹‰çš„æ¨¡å—ç³»ç»Ÿ**ã€‚

### âœ… å¤„ç†æœºåˆ¶

* è¯†åˆ«å¯¼å‡ºç±»å‹ï¼›
* ç»Ÿä¸€å°è£…ä¸º `__webpack_require__`ï¼›
* è‡ªåŠ¨å…¼å®¹é»˜è®¤å¯¼å‡ºä¸å‘½åå¯¼å‡ºã€‚

### ğŸ“˜ ä¾‹å­

```js
// utils.js (CommonJS)
module.exports = { a: 1 }

// index.js (ESM)
import utils from './utils';
console.log(utils.a);
```

Webpack ä¼šè‡ªåŠ¨ç”ŸæˆåŒ…è£…ä»£ç ï¼š

```js
var __webpack_exports__ = __webpack_require__("./utils.js");
```

ğŸ§  **æ€»ç»“**ï¼š

> Webpack é€šè¿‡æ„å»ºé˜¶æ®µé™æ€åˆ†æ + è¿è¡Œæ—¶å°è£…æœºåˆ¶ï¼Œå…¼å®¹ ESModule ä¸ CommonJSã€‚

---

## **2ï¸âƒ£ Webpack æ˜¯å¦‚ä½•å®ç°æ¨¡å—åŒ–åŠ è½½çš„ï¼Ÿ**

Webpack ä¼šå°†æ‰€æœ‰æ¨¡å—æ‰“åŒ…è¿›ä¸€ä¸ªç«‹å³æ‰§è¡Œå‡½æ•°ï¼ˆIIFEï¼‰ä¸­ï¼Œå¹¶ä½¿ç”¨ `__webpack_require__` æ¥æ¨¡æ‹Ÿ Node.js çš„ `require` åŠŸèƒ½ã€‚

### ğŸ’¡ æ¨¡æ‹Ÿæœºåˆ¶

1. æ‰€æœ‰æ¨¡å—è¢«æ”¾è¿›ä¸€ä¸ªå¯¹è±¡ `modules = { moduleId: function(...) {...} }`
2. å®šä¹‰ä¸€ä¸ªç¼“å­˜å¯¹è±¡ï¼›
3. å®ç°è‡ªå®šä¹‰çš„ `__webpack_require__`ï¼›
4. ç¼“å­˜æ‰§è¡Œç»“æœï¼Œé˜²æ­¢é‡å¤åŠ è½½ã€‚

### ğŸ“˜ ç¤ºä¾‹

```js
(function(modules) {
  var installedModules = {};

  function __webpack_require__(id) {
    if (installedModules[id]) return installedModules[id].exports;
    var module = installedModules[id] = { exports: {} };
    modules[id].call(module.exports, module, module.exports, __webpack_require__);
    return module.exports;
  }

  return __webpack_require__("./src/index.js");
})({
  "./src/index.js": function(module, exports, __webpack_require__) {
    const msg = __webpack_require__("./src/msg.js");
    console.log(msg);
  },
  "./src/msg.js": function(module) {
    module.exports = "Hello Webpack";
  }
});
```

ğŸ§  **æ€»ç»“**ï¼š

> Webpack çš„æ¨¡å—åŠ è½½æ˜¯é€šè¿‡å‡½æ•°åŒ…è£… + è‡ªå®šä¹‰çš„ `__webpack_require__` å®ç°çš„ã€‚

---

## **3ï¸âƒ£ ä»€ä¹ˆæ˜¯ HMRï¼ˆçƒ­æ›´æ–°ï¼‰ï¼ŸåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ**

**HMRï¼ˆHot Module Replacementï¼‰** æ˜¯ Webpack çš„â€œçƒ­æ¨¡å—æ›¿æ¢â€ï¼Œå¯åœ¨ä¸åˆ·æ–°é¡µé¢çš„æƒ…å†µä¸‹å®æ—¶æ›¿æ¢æ¨¡å—å†…å®¹ã€‚

### ğŸ”§ å®ç°æµç¨‹

1. **Webpack-dev-server å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨**
2. ç›‘æµ‹æºç å˜åŒ– â†’ Webpack é‡æ–°ç¼–è¯‘
3. æ–°æ¨¡å—æ‰“åŒ…å­˜å…¥å†…å­˜ä¸­ï¼ˆéç£ç›˜ï¼‰
4. DevServer é€šè¿‡ **WebSocket** é€šçŸ¥æµè§ˆå™¨
5. æµè§ˆå™¨æ‰§è¡Œ `module.hot.accept()` æ›´æ–°æ¨¡å—

### ğŸ“˜ ä»£ç ç¤ºä¾‹

```js
if (module.hot) {
  module.hot.accept('./math.js', function() {
    console.log('math æ¨¡å—æ›´æ–°äº†');
  });
}
```

ğŸ§  **æ€»ç»“**

> HMR ä¾é  WebSocket é€šä¿¡ä¸è¿è¡Œæ—¶æ¨¡å—æ›¿æ¢æœºåˆ¶ï¼Œå®ç°äº†æ¨¡å—çº§çš„çƒ­æ›´æ–°ï¼Œè€Œæ— éœ€åˆ·æ–°æ•´ä¸ªé¡µé¢ã€‚

---

## **4ï¸âƒ£ Webpack ä¸­ `require.context()` çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ**

`require.context()` æ˜¯ Webpack æä¾›çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äº**æ‰¹é‡å¯¼å…¥æ¨¡å—**ã€‚

### ğŸ“˜ è¯­æ³•

```js
require.context(directory, useSubdirectories, regExp)
```

### âœ… ç¤ºä¾‹

```js
const modules = require.context('./components', true, /\.js$/);
modules.keys().forEach(key => {
  console.log(key, modules(key));
});
```

ğŸ§  **ä½œç”¨**

* åŠ¨æ€åŠ è½½å¤šä¸ªæ–‡ä»¶ï¼›
* å¸¸ç”¨äº Vue çš„è‡ªåŠ¨ç»„ä»¶æ³¨å†Œï¼›
* Webpack åœ¨ç¼–è¯‘æ—¶å°±ä¼šåˆ†æå¹¶æ‰“åŒ…åŒ¹é…çš„æ¨¡å—ã€‚

---

## **5ï¸âƒ£ Webpack ä¸­çš„ `sideEffects` å±æ€§æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ**

`sideEffects` æ˜¯å¸®åŠ© Webpack åš **Tree Shaking ä¼˜åŒ–** çš„å…³é”®é…ç½®ã€‚

### ğŸ“˜ é…ç½®æ–¹å¼

```json
// package.json
{
  "sideEffects": false
}
```

è¡¨ç¤ºï¼š

* è¯¥åŒ…æ‰€æœ‰æ–‡ä»¶éƒ½**æ²¡æœ‰å‰¯ä½œç”¨**ï¼›
* Webpack å¯ä»¥å®‰å…¨åœ°åˆ é™¤æœªä½¿ç”¨çš„æ¨¡å—ã€‚

### âœ… ä¾‹å¤–æƒ…å†µ

å¦‚æœæŸäº›æ–‡ä»¶æœ‰å‰¯ä½œç”¨ï¼š

```json
{
  "sideEffects": ["./src/styles.css"]
}
```

ğŸ§  **æ€»ç»“**

> `"sideEffects": false` å‘Šè¯‰ Webpack å¯ä»¥å®‰å…¨åˆ é™¤æœªè¢«å¼•ç”¨çš„æ¨¡å—ï¼Œæé«˜ Tree Shaking æ•ˆæœã€‚

---

## **6ï¸âƒ£ Babel ä¸ Webpack çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ**

> äºŒè€…æ˜¯â€œç¼–è¯‘ + æ‰“åŒ…â€çš„å…³ç³»ã€‚

| å·¥å…·          | èŒè´£               |
| ----------- | ---------------- |
| **Babel**   | è½¬è¯‘æ–°è¯­æ³•ï¼ˆES6 â†’ ES5ï¼‰ |
| **Webpack** | æ¨¡å—æ‰“åŒ…ã€ä¾èµ–ç®¡ç†ã€èµ„æºæ„å»º   |

### ğŸ“˜ é…åˆæ–¹å¼

Webpack è°ƒç”¨ Babelï¼š

```js
module: {
  rules: [
    {
      test: /\.js$/,
      use: 'babel-loader',
      exclude: /node_modules/,
    },
  ],
}
```

ğŸ§  **æ€»ç»“**

> Webpack è°ƒç”¨ Babel ç¼–è¯‘æ–‡ä»¶ï¼ŒBabel æŠŠè¯­æ³•è½¬æ¢æˆå…¼å®¹å½¢å¼ï¼ŒWebpack å†è´Ÿè´£è¾“å‡º bundleã€‚

---

## **7ï¸âƒ£ å¦‚ä½•åœ¨ Webpack ä¸­ä½¿ç”¨ TypeScriptï¼Ÿ**

ä¸¤ç§æ–¹å¼ï¼š

### âœ… æ–¹å¼ 1ï¼š`ts-loader`ï¼ˆå®˜æ–¹æ¨èï¼‰

```bash
npm install ts-loader typescript -D
```

```js
module: {
  rules: [
    {
      test: /\.tsx?$/,
      use: 'ts-loader',
      exclude: /node_modules/,
    },
  ],
},
resolve: {
  extensions: ['.ts', '.tsx', '.js'],
},
```

### âœ… æ–¹å¼ 2ï¼šBabel è½¬è¯‘ TSï¼ˆæ›´å¿«ï¼‰

```bash
npm install babel-loader @babel/preset-typescript -D
```

```js
rules: [
  {
    test: /\.tsx?$/,
    use: {
      loader: 'babel-loader',
      options: { presets: ['@babel/preset-typescript'] },
    },
  },
]
```

ğŸ§  **æ€»ç»“**

> `ts-loader` è°ƒç”¨ TypeScript ç¼–è¯‘å™¨ï¼›`babel-loader` è½¬è¯‘æ›´å¿«ä½†ä¸åšç±»å‹æ£€æŸ¥ã€‚

---

## **8ï¸âƒ£ Webpack ä¸­å¦‚ä½•é…ç½® polyfillï¼Ÿ**

Webpack 5 ä¸å†è‡ªåŠ¨æ³¨å…¥ Node.js çš„ polyfillï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®ã€‚

### âœ… æ–¹æ³• 1ï¼šé€šè¿‡ Babel + core-js è‡ªåŠ¨æ³¨å…¥

```bash
npm install core-js regenerator-runtime -D
```

```js
// babel.config.js
{
  presets: [
    ['@babel/preset-env', {
      useBuiltIns: 'usage',
      corejs: 3
    }]
  ]
}
```

### âœ… æ–¹æ³• 2ï¼šProvidePlugin æ³¨å…¥

```js
const webpack = require('webpack');
plugins: [
  new webpack.ProvidePlugin({
    process: 'process/browser',
    Buffer: ['buffer', 'Buffer'],
  }),
];
```

ğŸ§  **æ€»ç»“**

> Babel ç”¨äºå‰ç«¯ API polyfillï¼ŒProvidePlugin ç”¨äº Node ç¯å¢ƒ polyfillã€‚

---

## **9ï¸âƒ£ Webpack ä¸ Node.js çš„æ¨¡å—ç³»ç»ŸåŒºåˆ«ï¼Ÿ**

| å¯¹æ¯”é¡¹  | Webpack                  | Node.js            |
| ---- | ------------------------ | ------------------ |
| æ‰§è¡Œç¯å¢ƒ | æµè§ˆå™¨                      | æœåŠ¡ç«¯                |
| åŠ è½½æ–¹å¼ | ç¼–è¯‘æ—¶é™æ€åŠ è½½                  | è¿è¡Œæ—¶åŠ¨æ€åŠ è½½            |
| æ¨¡å—ç±»å‹ | ESM + CJS éƒ½å¯             | ä¸»è¦æ˜¯ CJS            |
| ç¼“å­˜æœºåˆ¶ | `__webpack_require__` ç¼“å­˜ | `require.cache` ç¼“å­˜ |
| ä¾èµ–è§£æ | enhanced-resolve ç®—æ³•      | Node åŸç”Ÿç®—æ³•          |
| æ–‡ä»¶è¾“å‡º | æ‰“åŒ…åå•æ–‡ä»¶                   | æ¯ä¸ªæ–‡ä»¶å•ç‹¬åŠ è½½           |

ğŸ§  **æ€»ç»“**

> Webpack æ˜¯**ç¼–è¯‘æ—¶æ¨¡å—ç³»ç»Ÿ**ï¼ŒNode æ˜¯**è¿è¡Œæ—¶æ¨¡å—ç³»ç»Ÿ**ã€‚

---

## **ğŸ”Ÿ Webpack æ‰“åŒ…åçš„ä»£ç æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ**

Webpack è¾“å‡ºçš„ bundle æ˜¯ä¸€ä¸ªè‡ªæ‰§è¡Œå‡½æ•°ï¼Œå†…éƒ¨å®ç°ä¸€ä¸ªç®€åŒ–ç‰ˆçš„æ¨¡å—ç³»ç»Ÿï¼š

### ğŸ“˜ æ‰§è¡Œæµç¨‹

1. åˆå§‹åŒ– `modules` å¯¹è±¡ï¼›
2. å®šä¹‰ `__webpack_require__`ï¼›
3. ç¼“å­˜æ¨¡å—ç»“æœï¼›
4. ä»å…¥å£æ¨¡å—æ‰§è¡Œï¼›
5. è¿”å›å¯¼å‡ºå†…å®¹ã€‚

### âœ… ä»£ç ç»“æ„

```js
(function(modules) {
  var cache = {};

  function __webpack_require__(id) {
    if (cache[id]) return cache[id].exports;
    var module = cache[id] = { exports: {} };
    modules[id].call(module.exports, module, module.exports, __webpack_require__);
    return module.exports;
  }

  return __webpack_require__("./src/index.js");
})({
  "./src/index.js": function(module, exports, __webpack_require__) {
    const msg = __webpack_require__("./src/msg.js");
    console.log(msg);
  },
  "./src/msg.js": function(module) {
    module.exports = "Hello Webpack";
  }
});
```

ğŸ§  **æ€»ç»“**

> Webpack å°†æ‰€æœ‰æ¨¡å—åŒ…è£…è¿›å‡½æ•°ï¼Œé€šè¿‡ `__webpack_require__` å®ç°åŠ è½½å’Œä¾èµ–ç®¡ç†ã€‚

