非常好 👍
**WebSocket** 是前端、后端、全栈面试中的高频知识点之一，特别在实时通信、推送、聊天、协同编辑等场景中常被问到。下面我为你整理一份 **超完整的《WebSocket 面试题大全》**，从基础到原理、协议、实现、优化、安全、项目实战都有覆盖。

---

# 🧩 一、WebSocket 基础概念题

### 1. 什么是 WebSocket？

> **答：**
> WebSocket 是一种 **全双工（Full-duplex）通信协议**，运行在 TCP 之上，允许客户端与服务器之间进行 **持久连接**，实现 **实时数据交互**。

与 HTTP 不同，它在连接建立后可 **双向通信**，无需每次请求都重新建立连接。

---

### 2. WebSocket 与 HTTP 的区别？

| 对比项   | WebSocket                   | HTTP                      |
| -------- | --------------------------- | ------------------------- |
| 连接方式 | 持久连接（长连接）          | 短连接                    |
| 通信方向 | 双向                        | 单向（客户端 → 服务器）   |
| 传输协议 | 独立协议（ws:// 或 wss://） | http:// 或 https://       |
| 建立连接 | 一次握手，后续复用          | 每次请求重新建立 TCP 连接 |
| 延迟     | 极低（实时）                | 较高（需重复请求）        |
| 适用场景 | 实时通信、推送、游戏        | 请求响应型应用            |

---

### 3. WebSocket 的应用场景有哪些？

> **常见场景：**

- 聊天系统（IM）
- 实时推送（股票、体育比分）
- 协同编辑（Google Docs）
- 在线游戏
- 实时监控系统
- IoT 设备通信

---

### 4. WebSocket 使用的端口？

- 默认端口：`80`（ws）
- 加密端口：`443`（wss）

---

### 5. WebSocket 的连接地址格式？

```
ws://example.com:8080/path
wss://example.com:443/path
```

---

# ⚙️ 二、WebSocket 握手与协议题

### 6. WebSocket 是如何建立连接的？

> **答：**
> WebSocket 建立连接需要一次 **HTTP 握手（Upgrade 请求）**，流程如下：

1. 客户端发起带有 `Upgrade: websocket` 的 HTTP 请求；
2. 服务器响应 `101 Switching Protocols`；
3. 双方从 HTTP 升级到 WebSocket 通信。

---

### 7. WebSocket 握手时的关键头部有哪些？

**客户端请求头：**

```
GET /chat HTTP/1.1
Host: example.com:8080
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==
Sec-WebSocket-Version: 13
```

**服务器响应头：**

```
HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=
```

---

### 8. 什么是 `Sec-WebSocket-Key` 和 `Sec-WebSocket-Accept`？

> **答：**

- 客户端生成一个随机字符串作为 `Sec-WebSocket-Key`；
- 服务器接收后，将该值与固定 GUID 拼接，进行 **SHA-1 + Base64** 加密；
- 结果返回在 `Sec-WebSocket-Accept` 中；
- 浏览器校验一致后，连接升级成功。

---

### 9. WebSocket 为什么需要握手阶段？

> **答：**

- 验证服务器是否支持 WebSocket；
- 协议安全性：防止普通 HTTP 请求伪造；
- 建立持久连接后，复用 TCP 通道。

---

### 10. WebSocket 使用的协议版本是？

> **RFC 6455**（正式版本）

---

# 🔄 三、WebSocket 通信与原理题

### 11. WebSocket 是基于 TCP 还是 UDP？

> **答：**
> WebSocket 是 **基于 TCP** 的应用层协议。

---

### 12. WebSocket 是如何保持长连接的？

> **答：**

- 建立连接后，保持 TCP 通道不断开；
- 使用 **心跳机制（Ping/Pong）** 检测连接是否可用；
- 若无响应则重连。

---

### 13. WebSocket 消息有哪些类型？

> **答：**

1. 文本消息（Text）
2. 二进制消息（Binary）
3. 控制帧（Close / Ping / Pong）

---

### 14. WebSocket 的帧结构是什么？

> **答：**
> WebSocket 数据以「帧（Frame）」形式传输，每帧结构如下：

```
FIN | RSV | Opcode | Mask | Payload length | Masking-key | Payload data
```

- **Opcode**：数据类型（1：文本，2：二进制，8：关闭）
- **Masking-key**：客户端发送时必须使用掩码
- **Payload data**：实际数据内容

---

### 15. WebSocket 的消息是如何分片的？

> **答：**
> 消息可以被拆分为多个帧（fragmentation），每帧都有 FIN 位标记是否是最后一帧。
> 这样可实现 **大文件传输** 或 **流式传输**。

---

# 🧠 四、WebSocket 与其它技术对比题

### 16. WebSocket vs SSE（Server-Sent Events）

| 特性         | WebSocket        | SSE                     |
| ------------ | ---------------- | ----------------------- |
| 方向         | 双向             | 单向（服务器 → 客户端） |
| 协议         | 独立协议         | 基于 HTTP               |
| 二进制支持   | ✅ 支持          | ❌ 不支持               |
| 浏览器兼容性 | 较新浏览器       | 更广                    |
| 适用场景     | 聊天、游戏、协作 | 实时推送、日志流        |

---

### 17. WebSocket vs HTTP 长轮询

| 特性       | WebSocket | HTTP 长轮询      |
| ---------- | --------- | ---------------- |
| 延迟       | 低        | 较高             |
| 连接       | 一次持久  | 多次重连         |
| 开销       | 小        | 较大（反复请求） |
| 实现复杂度 | 较高      | 较低             |

---

### 18. WebSocket vs HTTP/2

> **答：**

- HTTP/2 支持多路复用，但依然是请求-响应模式；
- WebSocket 是全双工通信；
- 二者可结合使用（HTTP/2 WebSocket 仍在标准化中）。

---

# 🔐 五、安全与性能题

### 19. WebSocket 如何保证安全性？

> **答：**

1. 使用加密协议 `wss://`（基于 TLS）；
2. 校验 `Origin` 防止 CSRF；
3. 连接认证（token / cookie）；
4. 心跳检测防止死连接；
5. 服务端限速、防刷。

---

### 20. WebSocket 断开重连怎么实现？

> **答：**
> 前端可用如下逻辑：

```js
let socket;

function connect() {
  socket = new WebSocket("wss://example.com");
  socket.onopen = () => console.log("Connected");
  socket.onclose = () => {
    console.log("Disconnected, retrying...");
    setTimeout(connect, 2000);
  };
}
connect();
```

---

### 21. WebSocket 如何防止内存泄漏？

> **答：**

- 连接关闭时清理定时器；
- 移除事件监听；
- 限制最大连接数；
- 服务器端连接池管理。

---

### 22. WebSocket 如何做心跳检测？

> **答：**
> 客户端定期发送 `ping` 消息，若服务器超时未响应 `pong`，则断开重连。

```js
let heartbeat = setInterval(() => {
  socket.send(JSON.stringify({ type: "ping" }));
}, 30000);
```

---

# 💬 六、实战与框架题

### 23. 前端如何创建 WebSocket 连接？

```js
const ws = new WebSocket("wss://example.com");

ws.onopen = () => console.log("Connected");
ws.onmessage = (e) => console.log("Message:", e.data);
ws.onclose = () => console.log("Closed");
ws.onerror = (e) => console.error("Error:", e);
```

---

### 24. Node.js 如何实现 WebSocket 服务端？

```js
import { WebSocketServer } from "ws";

const wss = new WebSocketServer({ port: 8080 });

wss.on("connection", (ws) => {
  ws.on("message", (msg) => ws.send(`Echo: ${msg}`));
});
```

---

### 25. Express + WebSocket 怎么结合？

> **答：**
> 可以用 `ws` 或 `socket.io` 库；
> Express 处理 HTTP，WebSocket 处理实时通信。

---

### 26. WebSocket 与 Socket.IO 的区别？

| 特性       | WebSocket      | Socket.IO                          |
| ---------- | -------------- | ---------------------------------- |
| 协议层     | 原生协议       | 封装在 WebSocket + HTTP 长轮询之上 |
| 浏览器兼容 | 较新           | 更广（自动降级）                   |
| 功能       | 仅通信         | 额外功能（房间、广播、重连）       |
| 使用场景   | 自定义、轻量化 | 快速开发、多人通信                 |

---

### 27. WebSocket 如何处理多人聊天？

> **答：**

1. 服务端维护用户连接列表；
2. 消息广播或定向发送；
3. 支持房间（channel）机制；
4. 消息格式：JSON 对象 `{type, sender, content}`。

---

### 28. WebSocket 后端如何做负载均衡？

> **答：**

- 使用 **Sticky Session（粘性会话）**；
- 或使用 **Redis Pub/Sub** 同步消息；
- Nginx 反向代理时需设置：

```nginx
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection "upgrade";
```

---

# 📈 七、性能与优化题

### 29. 如何提升 WebSocket 性能？

> **答：**

- 使用二进制消息（减少编码体积）；
- 心跳检测与断线重连；
- 合并小包发送；
- 服务端使用事件驱动模型（Node.js、Go、Netty）；
- 结合 CDN/边缘节点。

---

### 30. WebSocket 消息推送如何设计？

> **答：**

- 使用 **消息队列（Kafka / RabbitMQ）**；
- 服务端通过事件通知；
- 前端统一接收事件并分发。

---

# 🧱 八、高频总结表

| 分类 | 高频题                                |
| ---- | ------------------------------------- |
| 基础 | WebSocket 是什么？与 HTTP 有何不同？  |
| 协议 | 握手流程与关键 Header？               |
| 实现 | 前端/Node.js 代码实现？               |
| 优化 | 如何重连？如何检测心跳？              |
| 安全 | wss 与 Origin 校验？                  |
| 对比 | WebSocket vs SSE / Socket.IO / 长轮询 |
| 实战 | 聊天、推送、监控系统如何设计？        |

---

要不要我帮你把这份内容整理成一份 **「WebSocket 高频面试题速记手册」PDF**（带图示 + 简答版 + 实战模板），方便你打印复习或面试前快速翻阅？
