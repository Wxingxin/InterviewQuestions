åœ¨ **NestJS** ä¸­ï¼Œ**VOï¼ˆValue Objectï¼‰å¸¸ç”¨äºå°è£…â€œè¿”å›ç»™å‰ç«¯çš„å“åº”æ•°æ®ç»“æ„â€**ï¼Œå®ƒä¸ DTOï¼ˆå…¥å‚ï¼‰ç›¸åï¼ŒDTO ç®¡è¾“å…¥ï¼ŒVO ç®¡è¾“å‡ºã€‚
VO **ä¸å‚ä¸æ ¡éªŒ**ï¼ˆé€šå¸¸ä¸éœ€è¦ class-validatorï¼‰ï¼Œä¸»è¦ç”¨äºï¼š

* **éšè—ä¸åº”è¯¥è¿”å›çš„å­—æ®µ**ï¼ˆå¦‚å¯†ç ï¼‰
* **ä¿è¯è¾“å‡ºç»“æ„ä¸€è‡´**
* **å¯¹è¿”å›æ•°æ®åšæ ¼å¼åŒ–/æ˜ å°„**
* **åœ¨ swagger ä¸­ç”Ÿæˆç¨³å®šçš„å“åº”æ¨¡å‹**
* **è¾“å‡ºåˆ†å±‚ï¼ˆéµå¾ª DDDï¼‰**

ä¸‹é¢ç»™ä½ ä¸€ä»½ **â€œVO ç”¨æ³•å¤§å…¨ + ç»å…¸å·¥ç¨‹ä»£ç â€**ã€‚

---

# ğŸ”¥ ä¸€ã€ä»€ä¹ˆæ˜¯ VOï¼ˆValue Objectï¼‰

ç®€å•è¯´ï¼š

* **DTO** = å‰ç«¯è¯·æ±‚ â†’ åç«¯ï¼ˆè¾“å…¥ï¼‰
* **VO** = åç«¯ â†’ å‰ç«¯å“åº”ï¼ˆè¾“å‡ºï¼‰

VO å¸¸ç”¨äºåœ¨ API å“åº”ä¸­â€œåŒ…è£…ä¸€å±‚å¯¹è±¡â€ï¼Œè®©æ¥å£è¿”å›ç»Ÿä¸€ç»“æ„æˆ–å±è”½å†…éƒ¨å­—æ®µã€‚

---

# ğŸ”§ äºŒã€NestJS ä¸­ VO çš„ä¸‰ç§å¸¸è§å†™æ³•

## **â‘  æœ€å¸¸è§ï¼šç”¨äº API è¿”å›çš„ class ç»“æ„ï¼ˆæ¨èï¼‰**

```ts
export class UserVO {
  id: number;
  username: string;
  avatar: string;
  createdAt: Date;
}
```

Controllerï¼š

```ts
@Get(':id')
async findOne(@Param('id') id: number): Promise<UserVO> {
  const user = await this.userService.findOne(id);
  return new UserVO(user); // æˆ– manual mapping
}
```

å¦‚æœ VO éœ€è¦æ¥å—å®ä½“ã€è‡ªåŠ¨æ˜ å°„ï¼Œå¯ä»¥åšæ„é€ å‡½æ•°ï¼š

```ts
export class UserVO {
  id: number;
  username: string;
  avatar: string;
  createdAt: Date;

  constructor(partial: Partial<UserVO>) {
    Object.assign(this, partial);
  }
}
```

Serviceï¼š

```ts
return new UserVO({
  id: user.id,
  username: user.username,
  avatar: user.avatar,
  createdAt: user.createdAt,
});
```

---

## **â‘¡ çƒ­é—¨å¢å¼ºï¼šä½¿ç”¨ class-transformer è‡ªåŠ¨è½¬æ¢å®ä½“ â†’ VO**

```ts
import { Expose } from 'class-transformer';

export class UserVO {
  @Expose()
  id: number;

  @Expose()
  username: string;

  @Expose()
  avatar: string;

  @Expose()
  createdAt: Date;
}
```

Controllerï¼š

```ts
import { plainToInstance } from 'class-transformer';

@Get(':id')
async getUser(@Param('id') id: number) {
  const entity = await this.userService.findOne(id);
  return plainToInstance(UserVO, entity, { excludeExtraneousValues: true });
}
```

ğŸ”¥ å¥½å¤„ï¼š

* `excludeExtraneousValues: true` ä¼šè‡ªåŠ¨å‰”é™¤ entity ä¸­ä½ ä¸æš´éœ²çš„å­—æ®µï¼ˆå¦‚å¯†ç ï¼‰

---

## **â‘¢ ä¼ä¸šçº§ç»Ÿä¸€å“åº”ç»“æ„ï¼ˆResultVO + æ³›å‹ï¼‰**

å¸¸è§äºå¤§å‹é¡¹ç›®ï¼ŒæŠŠæ‰€æœ‰è¿”å›éƒ½åŒ…è£…æˆåŒä¸€ç§ç»“æ„ï¼š

```ts
export class ResultVO<T> {
  code: number;
  message: string;
  data: T;

  static success<T>(data: T): ResultVO<T> {
    return {
      code: 0,
      message: 'success',
      data,
    };
  }

  static error(message: string, code = 1): ResultVO<null> {
    return {
      code,
      message,
      data: null,
    };
  }
}
```

Controllerï¼š

```ts
@Get(':id')
async findOne(@Param('id') id: number): Promise<ResultVO<UserVO>> {
  const user = await this.userService.findOne(id);
  return ResultVO.success(new UserVO(user));
}
```

è¿™å°±æ˜¯å…¸å‹çš„åç«¯ç»Ÿä¸€å“åº”é£æ ¼ã€‚

---

# âœ¨ ä¸‰ã€VO ç»“åˆ Swagger çš„æ ‡å‡†å†™æ³•ï¼ˆéå¸¸æ¨èï¼‰

```ts
import { ApiProperty } from '@nestjs/swagger';

export class UserVO {
  @ApiProperty({ example: 1 })
  id: number;

  @ApiProperty({ example: 'Tom' })
  username: string;

  @ApiProperty({ example: 'https://xxx/avatar.png' })
  avatar: string;

  @ApiProperty({ example: '2023-01-01 12:00:00' })
  createdAt: string;
}
```

Controllerï¼š

```ts
@ApiOkResponse({ type: UserVO })
@Get(':id')
async findOne(@Param('id') id: number): Promise<UserVO> {
  const user = await this.userService.findOne(id);
  return new UserVO(user);
}
```

Swagger ä¸­å°±ä¼šè‡ªåŠ¨ç”Ÿæˆæ¼‚äº®ä¸”ç¨³å®šçš„å“åº”ç»“æ„æ–‡æ¡£ã€‚

---

# ğŸ¯ å››ã€VO vs DTO vs Entity åŒºåˆ«ï¼ˆé¢è¯•å¸¸é—®ï¼‰

| æ¦‚å¿µ         | ä½œç”¨         | æ˜¯å¦æ ¡éªŒ    | æ˜¯å¦ç›´æ¥è¿”å›å‰ç«¯   |
| ---------- | ---------- | ------- | ---------- |
| **DTO**    | æ¥æ”¶å‰ç«¯è¾“å…¥     | âœ” å¿…é¡»æ ¡éªŒ  | âŒ ä¸ç›´æ¥è¿”å›    |
| **VO**     | è¿”å›ç»™å‰ç«¯çš„æ•°æ®   | âŒ ä¸æ ¡éªŒ   | âœ”          |
| **Entity** | ORMå®ä½“ï¼ˆæ•°æ®åº“ï¼‰ | âŒ ä¸€èˆ¬ä¸æ ¡éªŒ | âŒ åƒä¸‡ä¸è¦ç›´æ¥è¿”å› |

å®ä½“è¿”å›ç»™å‰ç«¯ä¼šæ³„éœ²å¯†ç /å†…éƒ¨å­—æ®µï¼Œæ˜¯ç¦å¿Œã€‚

---

# ğŸ§  äº”ã€ä¸€ä¸ªå®Œæ•´çš„å…¸å‹ç”¨æ³•ï¼ˆDTO + Entity + VOï¼‰

### 1. è¾“å…¥ DTOï¼ˆç”¨æˆ·æ³¨å†Œï¼‰

```ts
export class RegisterDto {
  @IsEmail()
  email: string;

  @IsString()
  password: string;
}
```

### 2. æ•°æ®åº“å®ä½“ï¼ˆUserEntityï¼‰

```ts
@Entity()
export class User {
  @PrimaryGeneratedColumn()
  id: number;

  @Column()
  email: string;

  @Column()
  password: string;

  @Column()
  avatar: string;

  @CreateDateColumn()
  createdAt: Date;
}
```

### 3. è¾“å‡º VOï¼ˆVO è¿‡æ»¤æ‰ passwordï¼‰

```ts
export class UserVO {
  id: number;
  email: string;
  avatar: string;
  createdAt: Date;

  constructor(entity: User) {
    this.id = entity.id;
    this.email = entity.email;
    this.avatar = entity.avatar;
    this.createdAt = entity.createdAt;
  }
}
```

### 4. Controller

```ts
@Get(':id')
async findOne(@Param('id') id: number): Promise<UserVO> {
  const entity = await this.userService.findOne(id);
  return new UserVO(entity);
}
```

å‰ç«¯æ°¸è¿œæ‹¿ä¸åˆ° `password`ã€‚

---

# ğŸš€ å…­ã€æ€»ç»“ï¼šVO åœ¨ NestJS ä¸­çš„æ­£ç¡®ä½¿ç”¨æ–¹å¼

* VO **æ˜¯ç”¨æ¥å®šä¹‰è¾“å‡ºç»“æ„çš„ class**
* ä¸æ ¡éªŒï¼Œä»…ç”¨äºèµ‹å€¼ã€æ ¼å¼åŒ–å’Œæè¿°è¿”å›æ•°æ®
* ä¸è¦æŠŠ Entity ç›´æ¥æš´éœ²ç»™å‰ç«¯
* å¸¸é…åˆï¼š

  * `plainToInstance`
  * `excludeExtraneousValues`
  * Swagger çš„ `ApiProperty`
  * ç»Ÿä¸€å“åº”åŒ…è£…ç±» `ResultVO`

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘è¿˜å¯ä»¥å¸®ä½ ç”Ÿæˆï¼š

âœ” ä¸€å¥— **DTO + Entity + VO + æ§åˆ¶å™¨ + Swagger æ–‡æ¡£** çš„å®Œæ•´æ¨¡æ¿
âœ” æˆ–è€…æ ¹æ®ä½ çš„é¡¹ç›®ç»“æ„ï¼Œè®¾è®¡ä¸€ä¸ª **ç»Ÿä¸€è¿”å›è§„èŒƒï¼ˆResultVO + é”™è¯¯ç ä½“ç³»ï¼‰**

éœ€è¦å—ï¼Ÿ
