下面这一份可以理解成：**Vite 项目结构说明书 + vite.config 全配置导图**。你可以边看边对照自己项目。

---

## 一、典型 Vite 项目结构

以官方模版为例（如 `npm create vite@latest my-app`，选择 Vue/React 任意）：([vitejs][1])

```text
my-app/
├─ index.html
├─ vite.config.ts / vite.config.js
├─ package.json
├─ tsconfig.json / jsconfig.json
├─ public/
│   └─ favicon.svg ...
└─ src/
    ├─ main.tsx / main.ts / main.js
    ├─ App.vue / App.tsx / App.jsx
    ├─ assets/
    ├─ components/
    └─ ...
```

逐个讲清楚它们“干啥的”：

### 1. 根目录文件

* **`index.html`**

  * Vite 的入口文件（开发 + 打包都以它为入口）。([vitejs][2])
  * 可以在里面写 `<script type="module" src="/src/main.ts"></script>` 这种原生 ESModule 引用。
  * 也可以用特殊语法：`%PUBLIC_URL%` 这类在 Vite 不需要（来自 CRA），要改用 `import.meta.env` 方式。

* **`vite.config.ts/js`**

  * Vite 配置主文件，默认放项目根目录，名为 `vite.config.*` 就会被自动识别。([vitejs][3])
  * 推荐使用 TypeScript + `defineConfig`：

    ```ts
    // vite.config.ts
    import { defineConfig } from 'vite'
    import vue from '@vitejs/plugin-vue'

    export default defineConfig({
      plugins: [vue()],
      // 这里写各种配置
    })
    ```

* **`package.json`**

  * 脚本命令：`dev / build / preview` 都写在这里。
  * 依赖：`dependencies`、`devDependencies`。

* **`tsconfig.json / jsconfig.json`**

  * TypeScript / JS 工程配置，比如路径别名如果你在 Vite 里配了，还要在这里同步一份，方便 IDE 识别。

* **`.env*` 系列**

  * 环境变量文件（后面单独说）。

---

### 2. `/src` 目录

* **`main.ts / main.tsx / main.js`**

  * 前端应用真正“启动文件”，挂载到 DOM 上：

    ```ts
    import { createApp } from 'vue'
    import App from './App.vue'

    createApp(App).mount('#app')
    ```

* **`App.vue / App.(t|j)sx`**

  * 根组件。

* **`assets/`**

  * 存放需要通过构建处理的静态资源（图片、字体、样式等），通过 `import` 引用，Vite 会帮你转成 URL，生产环境会带 hash。([vitejs][4])

* **`components/`**

  * 普通业务组件，结构自由。

你可以按业务再划分子目录，比如：

```text
src/
  api/
  pages/
  router/
  store/
  hooks/
  utils/
```

---

### 3. `/public` 目录

* 默认由配置项 `publicDir` 指定，默认为 `"public"`。([vitejs][5])
* 特点：

  * **不会被打包处理**，原样拷贝到最终 `dist/` 根目录。
  * 开发环境可通过 `/xxx.png` 直接访问。
* 用法：

  * 大文件、第三方库、图标、manifest、robots.txt 等。

在 `vite.config` 中可以关闭或修改位置：

```ts
export default defineConfig({
  publicDir: 'static', // 自定义目录
  // publicDir: false   // 关闭 public 功能
})
```

---

## 二、`vite.config` 配置大全（按模块整理）

Vite 官方配置文档条目很多，我们按常用度给你列一张“最常用清单”。([vitejs][3])

### 1. 基础结构

```ts
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue' // 或 react()

export default defineConfig({
  plugins: [vue()],
  root: '.',          // 项目根目录（默认当前）
  base: '/',          // 部署基础路径
  publicDir: 'public',
  cacheDir: 'node_modules/.vite',

  resolve: { /* 路径解析 */ },
  server: { /* 开发服务器 */ },
  build: { /* 打包配置 */ },
  preview: { /* 预览服务器 */ },
  css: { /* CSS 相关 */ },
  json: { /* JSON 处理 */ },
  esbuild: { /* esbuild 相关 */ },
  optimizeDeps: { /* 依赖预构建 */ },
  define: { /* 全局常量替换 */ },
  plugins: [ /* 插件 */ ],
})
```

---

### 2. 路径解析：`resolve`

```ts
resolve: {
  alias: {
    '@': '/src',
    '~components': '/src/components'
  },
  // 导入时可以省略的扩展名
  extensions: ['.mjs', '.js', '.ts', '.jsx', '.tsx', '.json', '.vue']
}
```

* 常用场景：**路径别名**，避免 `../../../` 地狱。
* 注意：别忘了在 `tsconfig.json` 里同步配置别名。

---

### 3. 静态资源与公共目录：`publicDir`、`assets` 行为

* 在 `src` 里用 `import` 的资源：构建时会自动 hash + 按需复制。([vitejs][4])
* 在 `public` 里的资源：不处理、原样拷贝。
* 常见配置：

  ```ts
  publicDir: 'public', // 默认
  assetsInclude: ['**/*.gltf'] // 让特定类型的文件被当作资源处理
  ```

---

### 4. 开发服务器：`server`（非常常用）

参考官方 `server-options` 文档。([vitejs][6])

```ts
server: {
  host: '0.0.0.0',   // 允许局域网访问
  port: 5173,        // 默认 5173
  open: true,        // 自动打开浏览器
  https: false,      
  cors: true,        // 开启 CORS

  proxy: {
    // 反向代理配置
    '/api': {
      target: 'http://localhost:3000',
      changeOrigin: true,
      rewrite: path => path.replace(/^\/api/, '')
    }
  }
}
```

---

### 5. 预览服务器：`preview`

用于 `vite preview` 命令：

```ts
preview: {
  host: '0.0.0.0',
  port: 4173,
  open: false
}
```

---

### 6. 构建配置：`build`（打包相关）

参考 build options 文档。([vitejs][7])

```ts
build: {
  target: 'esnext',     // 浏览器兼容目标
  outDir: 'dist',       // 输出目录
  assetsDir: 'assets',  // 静态资源目录
  sourcemap: false,     
  minify: 'esbuild',    // 'esbuild' | 'terser' | false
  cssTarget: 'chrome61',// 特殊浏览器 CSS 兼容（可选）
  rollupOptions: {
    input: {
      main: 'index.html',
      // admin: 'admin.html'  // 多入口
    },
    output: {
      manualChunks: {      // 手动拆包
        vue: ['vue']
      }
    }
  },
  brotliSize: true,
  chunkSizeWarningLimit: 500,
}
```

一些常见实战点：

* **多页面应用**：`rollupOptions.input` 配置多个 HTML 入口。
* **代码分割**：`manualChunks` 手动指定大依赖单独打包。
* **分析包体积**：配合 `rollup-plugin-visualizer` 插件。

---

### 7. CSS 配置：`css`

```ts
css: {
  modules: {
    // CSS Modules 命名规则
    localsConvention: 'camelCaseOnly',
    generateScopedName: '[name]__[local]___[hash:base64:5]'
  },
  preprocessorOptions: {
    scss: {
      additionalData: `@use "@/styles/vars.scss" as *;`
    },
    less: {
      javascriptEnabled: true
    }
  },
  devSourcemap: true,
  // 使用 lightningcss / autoprefixer 等结合 PostCSS 配置
}
```

常见场景：

* 全局注入 SCSS/LESS 变量与 mixin。
* CSS Modules 命名自定义。
* 开发时开启 CSS sourcemap 方便排查。

---

### 8. JSON 处理：`json`

```ts
json: {
  namedExports: true,    // 按属性名导出
  stringify: false       // 为 true 时，直接导出 JSON 字符串
}
```

---

### 9. esbuild 相关：`esbuild`

Vite 用 esbuild 做很多底层工作（依赖预构建、TS/JS 转译等）。你可以做一些补充配置：

```ts
esbuild: {
  jsxFactory: 'h',
  jsxFragment: 'Fragment',
  drop: ['console', 'debugger'] // 生产环境去掉 console / debugger
}
```

---

### 10. 依赖预构建：`optimizeDeps`

用来控制开发时对 `node_modules` 的预构建行为。([vitejs][8])

```ts
optimizeDeps: {
  include: ['lodash-es', 'dayjs'],
  exclude: ['big-package-that-should-not-prebundle']
}
```

一般情况可以不动，只有遇到：

* 某个依赖在 dev 启动时报错；
* 需要强制预构建/排除预构建；

才去调整。

---

### 11. 全局常量替换：`define`

```ts
define: {
  __APP_VERSION__: JSON.stringify('1.0.0'),
  __BUILD_TIME__: JSON.stringify(new Date().toISOString())
}
```

* 编译时直接“字符串替换”，在代码中可直接使用 `__APP_VERSION__`。
* 常用于注入构建信息、开关（注意搭配 `JSON.stringify`）。([vitejs][5])

---

### 12. 插件系统：`plugins`

```ts
import vue from '@vitejs/plugin-vue'
import legacy from '@vitejs/plugin-legacy'

export default defineConfig({
  plugins: [
    vue(),
    legacy({
      targets: ['defaults', 'not IE 11']
    }),
    // 自己写的插件…
  ]
})
```

插件负责：

* 支持框架（Vue/React/Svelte 等）；
* 支持额外语言（Markdown、SVG 组件化等）；
* 构建优化（压缩、按需引入、自动导入）。

---

### 13. 环境变量 & `import.meta.env`

Vite 的环境变量体系大致是：

* 文件：

  * `.env` 所有环境都会加载；
  * `.env.development` 开发环境；
  * `.env.production` 生产环境；
* 变量名必须以 **`VITE_` 前缀**，才会暴露给客户端代码。

示例：

```env
# .env.development
VITE_API_BASE_URL=http://localhost:3000
```

在代码中：

```ts
const apiBase = import.meta.env.VITE_API_BASE_URL
const mode = import.meta.env.MODE          // 'development' | 'production'
const prod = import.meta.env.PROD          // boolean
const dev = import.meta.env.DEV            // boolean
```

---

## 三、推荐的“实践级”配置模板

给你一个比较“万能”的 TS + Vue 示例，你可以按需删减：

```ts
// vite.config.ts
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import path from 'node:path'

export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src'),
    },
  },
  publicDir: 'public',
  server: {
    host: '0.0.0.0',
    port: 5173,
    open: true,
    proxy: {
      '/api': {
        target: 'http://localhost:3000',
        changeOrigin: true,
        rewrite: p => p.replace(/^\/api/, ''),
      },
    },
  },
  preview: {
    host: '0.0.0.0',
    port: 4173,
  },
  css: {
    preprocessorOptions: {
      scss: {
        additionalData: `@use "@/styles/vars.scss" as *;`,
      },
    },
  },
  build: {
    target: 'esnext',
    outDir: 'dist',
    assetsDir: 'assets',
    sourcemap: false,
    rollupOptions: {
      output: {
        manualChunks: {
          vue: ['vue'],
        },
      },
    },
    chunkSizeWarningLimit: 500,
  },
  define: {
    __APP_VERSION__: JSON.stringify('1.0.0'),
  },
})
```

---

如果你愿意，可以把你现有项目的 `vite.config` 和目录结构发给我，我可以**按这个“大全”给你逐项诊断 + 优化**，顺便帮你做一份“适合你项目的最佳实践配置”。

[1]: https://vitejs.dev/guide/?utm_source=chatgpt.com "Getting Started"
[2]: https://vitejs.dev/guide/build.html?utm_source=chatgpt.com "Building for Production"
[3]: https://vitejs.dev/config/?utm_source=chatgpt.com "Configuring Vite"
[4]: https://vitejs.dev/guide/assets.html?utm_source=chatgpt.com "Static Asset Handling"
[5]: https://vitejs.dev/config/shared-options.html?utm_source=chatgpt.com "Shared Options"
[6]: https://vitejs.dev/config/server-options.html?utm_source=chatgpt.com "Server Options"
[7]: https://vitejs.dev/config/build-options.html?utm_source=chatgpt.com "Build Options"
[8]: https://vitejs.dev/guide/features.html?utm_source=chatgpt.com "Features"
